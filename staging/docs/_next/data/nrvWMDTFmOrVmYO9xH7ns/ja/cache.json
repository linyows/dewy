{"pageProps":{"markdoc":{"content":{"$$mdtype":"Tag","name":"article","attributes":{},"children":[{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"overview","level":1},"children":["キャッシュ"," "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["キャッシュは、ダウンロード済みアーティファクトを管理し、冗長なネットワークトラフィックを回避するDewyの重要なコンポーネントです。\n複数のキャッシュストア実装から選択でき、分散環境でのキャッシュ共有も可能です。\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"overview-details","level":2},"children":["概要 "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["キャッシュコンポーネントは、Dewyのデプロイプロセスにおいて以下の重要な役割を担います："]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["アーティファクトの保存"]},": ダウンロードしたバイナリファイルの永続化"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["バージョン管理"]},": 現在のバージョン情報の記録と管理"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["重複ダウンロード防止"]},": 同一バージョンの再ダウンロードを回避"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["高速デプロイ"]},": ローカルキャッシュからの即座な展開"]}]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["キャッシュは、KVSインターフェースによって抽象化されており、用途に応じて異なる実装を選択できます。"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"cache-stores","level":2},"children":["キャッシュストア実装 "]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"file-cache","level":3},"children":["ファイルシステム（File）- デフォルト "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["ローカルファイルシステムにアーティファクトを保存する最も基本的な実装です。"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["特徴:"]}]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["永続的なデータ保存"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["システム再起動後もデータ保持"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["シンプルな設定と管理"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["アーカイブ展開機能を内蔵"]}]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["サポートされるアーカイブ形式:"]}]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"code","attributes":{},"children":[".tar.gz"]}," / ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":[".tgz"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"code","attributes":{},"children":[".tar.bz2"]}," / ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":[".tbz2"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"code","attributes":{},"children":[".tar.xz"]}," / ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":[".txz"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"code","attributes":{},"children":[".tar"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"code","attributes":{},"children":[".zip"]}]}]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"memory-cache","level":3},"children":["メモリ（Memory）"]},{"$$mdtype":"Tag","name":"Callout","attributes":{"type":"warning","title":"未実装"},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Memoryキャッシュは現在未実装です。将来のバージョンで対応予定です。"]}]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["インメモリでアーティファクトを管理する高速な実装（予定）。"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["想定される特徴:"]}]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["高速なアクセス"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["揮発性（再起動でデータ消失）"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["メモリ使用量の増加"]}]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"consul-cache","level":3},"children":["HashiCorp Consul "]},{"$$mdtype":"Tag","name":"Callout","attributes":{"type":"warning","title":"未実装"},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Consulキャッシュは現在未実装です。将来のバージョンで対応予定です。"]}]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["分散環境でのキャッシュ共有を実現する実装（予定）。"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["想定される利点:"]}]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["複数Dewyインスタンス間でのキャッシュ共有"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["レジストリへのリクエスト削減"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["分散システムでのレート制限対策"]}]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"redis-cache","level":3},"children":["Redis "]},{"$$mdtype":"Tag","name":"Callout","attributes":{"type":"warning","title":"未実装"},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Redisキャッシュは現在未実装です。将来のバージョンで対応予定です。"]}]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["高性能な分散キャッシュシステムとの連携実装（予定）。"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["想定される特徴:"]}]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["高速な分散キャッシュ"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["TTL設定による自動expiration"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["クラスター対応"]}]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"cache-directory","level":2},"children":["キャッシュディレクトリ設定 "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Dewyは、以下の優先順位でキャッシュディレクトリを決定します："]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"1.-dewy_cachedir-環境変数（最高優先度）"},"children":["1. DEWY_CACHEDIR 環境変数（最高優先度）"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"sh"},"children":["export DEWY_CACHEDIR=/var/cache/dewy\ndewy server --registry ghr://owner/repo -- /opt/myapp/current/myapp\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"2.-カレントディレクトリ-+-.dewy/cache（デフォルト）"},"children":["2. カレントディレクトリ + .dewy/cache（デフォルト）"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"sh"},"children":["# /opt/myapp/.dewy/cache が使用される\ncd /opt/myapp\ndewy server --registry ghr://owner/repo -- ./current/myapp\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"3.-一時ディレクトリ（フォールバック）"},"children":["3. 一時ディレクトリ（フォールバック）"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["ディレクトリ作成に失敗した場合、自動的に一時ディレクトリにフォールバックします。"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"systemdでの設定例"},"children":["systemdでの設定例"]},{"$$mdtype":"Tag","name":"Callout","attributes":{"type":"note","title":"systemd運用のTips"},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["systemdでDewyを管理する場合は、",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["DEWY_CACHEDIR"]},"で専用のキャッシュディレクトリを指定することを推奨します。"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"ini"},"children":["# /etc/systemd/system/dewy.service\n[Unit]\nDescription=Dewy Application Deployment Service\nAfter=network.target\n\n[Service]\nType=simple\nUser=dewy\nGroup=dewy\nEnvironment=DEWY_CACHEDIR=/var/cache/dewy\nExecStart=/usr/local/bin/dewy server --registry ghr://myorg/myapp -- /opt/myapp/current/myapp\nRestart=always\nRestartSec=10\n\n[Install]\nWantedBy=multi-user.target\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["事前にディレクトリとアクセス権を設定："]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"sh"},"children":["sudo mkdir -p /var/cache/dewy\nsudo chown dewy:dewy /var/cache/dewy\nsudo chmod 755 /var/cache/dewy\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"docker環境での設定"},"children":["Docker環境での設定"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"sh"},"children":["# 永続ボリュームでキャッシュを保持\ndocker run -d \\\n  -e DEWY_CACHEDIR=/app/cache \\\n  -v /host/dewy-cache:/app/cache \\\n  dewy:latest server --registry ghr://owner/repo -- /opt/app/current/app\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"cache-keys","level":2},"children":["キャッシュキーの仕組み "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Dewyは、以下のキー構造でキャッシュを管理します："]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"currentキー"},"children":["currentキー"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["現在実行中のアプリケーションバージョンを示すspecialキーです。"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"sh"},"children":["# ファイルキャッシュの場合\ncat /var/cache/dewy/current\n# 出力例: v1.2.3--app_linux_amd64.tar.gz\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["この値は、実際のアーティファクトファイルを参照するキャッシュキーとして使用されます。"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"アーティファクトキー"},"children":["アーティファクトキー"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["バージョンタグとアーティファクト名を組み合わせた形式："]},{"$$mdtype":"Tag","name":"Fence","attributes":{},"children":["{version}--{artifact_name}\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["例:"]}]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"code","attributes":{},"children":["v1.2.3--myapp_linux_amd64.tar.gz"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"code","attributes":{},"children":["v2.0.0-rc.1--myapp_darwin_arm64.zip"]}]}]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"performance","level":2},"children":["パフォーマンス最適化 "]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"レート制限対策"},"children":["レート制限対策"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["複数のDewyインスタンスを運用する場合、以下の戦略でレジストリへのリクエストを削減できます："]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"sh"},"children":["# ポーリング間隔を長くする（デフォルト: 10秒）\ndewy server --registry ghr://owner/repo \\\n  --interval 60s -- /opt/myapp/current/myapp\n\n# 将来的には分散キャッシュ（Consul/Redis）でキャッシュ共有\n# dewy server --registry ghr://owner/repo \\\n#   --cache consul://localhost:8500 \\\n#   --interval 30s -- /opt/myapp/current/myapp\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"ストレージ管理"},"children":["ストレージ管理"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"sh"},"children":["# キャッシュサイズの制限（デフォルト: 64MB）\n# 現在はファイルキャッシュのディレクトリサイズで判定\ndu -sh /var/cache/dewy\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"operations","level":2},"children":["運用ガイド "]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"トラブルシューティング"},"children":["トラブルシューティング"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["キャッシュミスが頻発する場合:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"sh"},"children":["# キャッシュディレクトリの確認\nls -la $DEWY_CACHEDIR\n\n# currentキーの確認\ncat $DEWY_CACHEDIR/current\n\n# 権限の確認\nls -la $DEWY_CACHEDIR\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["権限エラーの場合:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"sh"},"children":["# ディレクトリ権限の修正\nsudo chown -R dewy:dewy /var/cache/dewy\nsudo chmod -R 755 /var/cache/dewy\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["ディスク容量不足の場合:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"sh"},"children":["# キャッシュディスクtリの使用量確認\ndf -h /var/cache/dewy\n\n# 古いキャッシュファイルの手動削除\nfind /var/cache/dewy -name \"v*\" -mtime +7 -delete\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"モニタリング"},"children":["モニタリング"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["キャッシュ利用状況の確認:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"sh"},"children":["# キャッシュファイル一覧\nls -la /var/cache/dewy/\n\n# 現在のバージョン確認\ncat /var/cache/dewy/current\n\n# ログでキャッシュアクセスを監視\njournalctl -u dewy.service -f | grep -i cache\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"best-practices","level":2},"children":["設定例とベストプラクティス "]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"本番環境での推奨設定"},"children":["本番環境での推奨設定"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"sh"},"children":["# systemd環境\nEnvironment=DEWY_CACHEDIR=/var/cache/dewy\n\n# 適切なポーリング間隔\n--interval 30s\n\n# 構造化ログでモニタリング\n--log-format json\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"開発環境での軽量設定"},"children":["開発環境での軽量設定"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"sh"},"children":["# プロジェクトディレクトリでの実行\ncd /path/to/myproject\ndewy server --registry ghr://owner/repo \\\n  --interval 5s \\\n  --log-format text -- ./current/myapp\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"高可用性構成での戦略"},"children":["高可用性構成での戦略"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["将来の分散キャッシュ対応時の想定設定："]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"sh"},"children":["# 複数インスタンスでConsulキャッシュ共有（予定）\n# dewy server --registry ghr://owner/repo \\\n#   --cache consul://consul-cluster:8500 \\\n#   --interval 60s -- /opt/myapp/current/myapp\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"related","level":2},"children":["関連項目 "]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"/ja/architecture"},"children":["アーキテクチャ"]}," - Dewyの全体構成とキャッシュの位置づけ"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"/ja/registry"},"children":["レジストリ"]}," - アーティファクトの取得元設定"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"/ja/faq"},"children":["FAQ"]}," - キャッシュ関連のよくある質問"]}]}]},"frontmatter":{"title":"キャッシュ","description":"キャッシュは、ダウンロード済みアーティファクトを管理し、冗長なネットワークトラフィックを回避するDewyの重要なコンポーネントです。\n複数のキャッシュストア実装から選択でき、分散環境でのキャッシュ共有も可能です。\n"},"file":{"path":"/ja/cache.md"}}},"__N_SSG":true}