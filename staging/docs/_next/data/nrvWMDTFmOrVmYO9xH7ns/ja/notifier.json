{"pageProps":{"markdoc":{"content":{"$$mdtype":"Tag","name":"article","attributes":{},"children":[{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"overview","level":1},"children":["通知"," "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["通知機能は、デプロイメントの状況をチームに自動で伝えるDewyのコンポーネントです。\n成功・失敗・フック実行結果など、様々なイベントをSlackやメールで通知できます。\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":2,"id":"対応通知方法"},"children":["対応通知方法"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Dewyは以下の通知方法に対応しています。"]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["Slack"]}," (",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["slack://"]},"): Slackチャンネルへの通知"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["Mail"]}," (",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["mail://"]},", ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["smtp://"]},"): SMTP経由でのメール通知"]}]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":2,"id":"通知のタイミング"},"children":["通知のタイミング"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Dewyは以下のタイミングで通知を送信します："]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["開始時"]},": Dewyサービスの開始"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["ダウンロード完了"]},": 新しいアーティファクトのダウンロード"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["デプロイ成功"]},": アプリケーションの起動・再起動成功"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["エラー発生"]},": 各種エラーの発生"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["フック実行"]},": Before/Afterフックの実行結果"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["停止時"]},": Dewyサービスの停止"]}]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":2,"id":"slack通知"},"children":["Slack通知"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["基本設定"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# 基本形式\nslack://<channel-name>\n\n# 例\ndewy server --registry ghr://owner/repo \\\n  --notifier slack://deployments \\\n  -- /opt/myapp/current/myapp\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["環境変数"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# Slack Bot Token（必須）\nexport SLACK_TOKEN=xoxb-xxxxxxxxxxxxxxxxxxxxx\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"slack-appの設定"},"children":["Slack Appの設定"]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["Slack Appの作成",{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"https://api.slack.com/apps"},"children":["https://api.slack.com/apps"]}," でアプリを作成"]}]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["必要な権限（Scopes）",{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"code","attributes":{},"children":["channels:join"]},": チャンネルへの参加"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"code","attributes":{},"children":["chat:write"]},": メッセージの投稿"]}]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["トークンの取得",{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["OAuth & Permissions → Bot User OAuth Token"]}]}]}]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"オプション付きの設定"},"children":["オプション付きの設定"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# タイトル付き通知\ndewy server --registry ghr://owner/repo \\\n  --notifier \"slack://deployments?title=MyApp\"\n\n# URL付き通知（リポジトリへのリンク等）\ndewy server --registry ghr://owner/repo \\\n  --notifier \"slack://deployments?title=MyApp&url=https://github.com/owner/repo\"\n\n# 複数オプション\ndewy server --registry ghr://owner/repo \\\n  --notifier \"slack://prod-deploy?title=MyApp&url=https://myapp.example.com\"\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"通知内容例"},"children":["通知内容例"]},{"$$mdtype":"Tag","name":"Fence","attributes":{},"children":["🚀 Automatic shipping started by Dewy (v1.2.3: server)\n\n✅ Downloaded artifact for v1.2.3\n\n🔄 Server restarted for v1.2.3\n\n❌ Deploy failed: connection timeout\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":2,"id":"メール通知"},"children":["メール通知"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["基本設定"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# 基本形式\nmail://<smtp-host>:<port>/<recipient>\n# または\nsmtp://<smtp-host>:<port>/<recipient>\n\n# 例\ndewy server --registry ghr://owner/repo \\\n  --notifier mail://smtp.gmail.com:587/admin@example.com \\\n  -- /opt/myapp/current/myapp\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["環境変数"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# SMTP認証情報\nexport MAIL_USERNAME=sender@gmail.com\nexport MAIL_PASSWORD=app-specific-password\nexport MAIL_FROM=sender@gmail.com\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"設定オプション"},"children":["設定オプション"]},{"$$mdtype":"Tag","name":"Table","attributes":{},"children":[{"$$mdtype":"Tag","name":"thead","attributes":{},"children":[{"$$mdtype":"Tag","name":"tr","attributes":{},"children":[{"$$mdtype":"Tag","name":"th","attributes":{},"children":["オプション"]},{"$$mdtype":"Tag","name":"th","attributes":{},"children":["型"]},{"$$mdtype":"Tag","name":"th","attributes":{},"children":["説明"]},{"$$mdtype":"Tag","name":"th","attributes":{},"children":["デフォルト値"]}]}]},{"$$mdtype":"Tag","name":"tbody","attributes":{},"children":[{"$$mdtype":"Tag","name":"tr","attributes":{},"children":[{"$$mdtype":"Tag","name":"td","attributes":{},"children":[{"$$mdtype":"Tag","name":"code","attributes":{},"children":["username"]}]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["string"]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["SMTP認証ユーザー名"]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["MAIL_USERNAME環境変数"]}]},{"$$mdtype":"Tag","name":"tr","attributes":{},"children":[{"$$mdtype":"Tag","name":"td","attributes":{},"children":[{"$$mdtype":"Tag","name":"code","attributes":{},"children":["password"]}]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["string"]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["SMTP認証パスワード"]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["MAIL_PASSWORD環境変数"]}]},{"$$mdtype":"Tag","name":"tr","attributes":{},"children":[{"$$mdtype":"Tag","name":"td","attributes":{},"children":[{"$$mdtype":"Tag","name":"code","attributes":{},"children":["from"]}]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["string"]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["送信者アドレス"]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["MAIL_FROM環境変数またはusername"]}]},{"$$mdtype":"Tag","name":"tr","attributes":{},"children":[{"$$mdtype":"Tag","name":"td","attributes":{},"children":[{"$$mdtype":"Tag","name":"code","attributes":{},"children":["subject"]}]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["string"]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["メール件名"]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["\"Dewy Notification\""]}]},{"$$mdtype":"Tag","name":"tr","attributes":{},"children":[{"$$mdtype":"Tag","name":"td","attributes":{},"children":[{"$$mdtype":"Tag","name":"code","attributes":{},"children":["tls"]}]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["bool"]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["TLS暗号化の使用"]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["true"]}]}]}]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"url形式での設定"},"children":["URL形式での設定"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# URLパラメータで全設定を指定\ndewy server --registry ghr://owner/repo \\\n  --notifier \"mail://smtp.gmail.com:587/admin@example.com?username=sender@gmail.com&password=app-password&from=sender@gmail.com&subject=Deploy+Notification\"\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"gmail-での設定例"},"children":["Gmail での設定例"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# 環境変数を使用\nexport MAIL_USERNAME=sender@gmail.com\nexport MAIL_PASSWORD=your-app-password\nexport MAIL_FROM=sender@gmail.com\n\n# Dewy実行\ndewy server --registry ghr://owner/repo \\\n  --notifier \"mail://smtp.gmail.com:587/admin@example.com?subject=MyApp+Deploy\"\n"]},{"$$mdtype":"Tag","name":"Callout","attributes":{"type":"important"},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Gmailを使用する場合は、2要素認証を有効にしてアプリパスワードを生成する必要があります。"," ","通常のGoogleアカウントパスワードでは認証できません。"]}]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":2,"id":"エラー通知の制限"},"children":["エラー通知の制限"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Dewyは連続するエラー通知を制限して、スパムを防止します。"]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["制限開始"]},": 連続3回のエラー後、通知を抑制"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["制限解除"]},": 正常な動作に戻ると自動的に制限を解除"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["制限中の動作"]},": ログは記録されるが通知は送信されない"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# エラー通知制限の例\n# 1回目: ✉️ Error notification sent\n# 2回目: ✉️ Error notification sent  \n# 3回目: ✉️ Error notification sent\n# 4回目: 📝 Error logged (notification suppressed)\n# 正常復旧: ✉️ Normal operation resumed, notification limit reset\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":2,"id":"フック実行結果の通知"},"children":["フック実行結果の通知"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["デプロイフック（Before/After Deploy Hook）の実行結果も通知されます："]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"成功時の通知例"},"children":["成功時の通知例"]},{"$$mdtype":"Tag","name":"Fence","attributes":{},"children":["🪝 Before Deploy Hook Success\nCommand: pg_dump mydb > backup.sql\nDuration: 2.3s\nExit Code: 0\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"失敗時の通知例"},"children":["失敗時の通知例"]},{"$$mdtype":"Tag","name":"Fence","attributes":{},"children":["❌ After Deploy Hook Failed\nCommand: systemctl reload nginx\nDuration: 0.1s\nExit Code: 1\nError: Unit nginx.service not found\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":2,"id":"複数環境での通知設定"},"children":["複数環境での通知設定"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"環境別チャンネル"},"children":["環境別チャンネル"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# 本番環境\ndewy server --registry ghr://owner/repo \\\n  --notifier \"slack://prod-deploy?title=MyApp+Production\"\n\n# ステージング環境\ndewy server --registry \"ghr://owner/repo?pre-release=true\" \\\n  --notifier \"slack://staging-deploy?title=MyApp+Staging\"\n\n# 開発環境\ndewy server --registry \"ghr://owner/repo?pre-release=true\" \\\n  --notifier \"slack://dev-deploy?title=MyApp+Development\"\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"systemdでの環境設定"},"children":["systemdでの環境設定"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"ini"},"children":["# /etc/systemd/system/dewy-myapp-prod.service\n[Unit]\nDescription=Dewy - MyApp Production\n\n[Service]\nEnvironment=SLACK_TOKEN=xoxb-prod-token\nExecStart=/usr/local/bin/dewy server \\\n  --registry ghr://owner/repo \\\n  --notifier \"slack://prod-deploy?title=MyApp+Prod\" \\\n  -- /opt/myapp/current/myapp\n\n# /etc/systemd/system/dewy-myapp-staging.service\n[Unit]\nDescription=Dewy - MyApp Staging\n\n[Service]\nEnvironment=SLACK_TOKEN=xoxb-staging-token\nExecStart=/usr/local/bin/dewy server \\\n  --registry \"ghr://owner/repo?pre-release=true\" \\\n  --notifier \"slack://staging-deploy?title=MyApp+Staging\" \\\n  -- /opt/myapp/current/myapp\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":2,"id":"トラブルシューティング"},"children":["トラブルシューティング"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Slack通知が届かない"]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["トークンの確認"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# トークンのテスト\ncurl -H \"Authorization: Bearer $SLACK_TOKEN\" \\\n  https://slack.com/api/auth.test\n"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["権限の確認"]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["Bot Token Scopesで ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["channels:join"]}," と ",{"$$mdtype":"Tag","name":"code","attributes":{},"children":["chat:write"]}," が設定されているか"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["Appがワークスペースにインストールされているか"]}]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["チャンネル名の確認"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# パブリックチャンネルの場合は # を除く\n# ❌ slack://#deployments\n# ✅ slack://deployments\n\n# プライベートチャンネルの場合は事前にBotを招待\n"]}]}]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["メール通知が送信されない"]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["SMTP設定の確認"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# SMTPサーバーへの接続テスト\ntelnet smtp.gmail.com 587\n"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["認証情報の確認"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# 環境変数の確認\necho $MAIL_USERNAME\necho $MAIL_FROM\n# パスワードは表示しない\n"]}]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["TLS設定の確認"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# TLSを無効にしてテスト（非推奨）\ndewy server --registry ghr://owner/repo \\\n  --notifier \"mail://smtp.example.com:25/admin@example.com?tls=false\"\n"]}]}]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"デバッグ方法"},"children":["デバッグ方法"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# デバッグログで通知処理を確認\ndewy server --registry ghr://owner/repo \\\n  --notifier slack://test-channel \\\n  --log-level debug\n\n# 通知のみをテストする場合\ndewy server --registry ghr://linyows/dewy \\\n  --notifier slack://test-channel \\\n  --log-level info\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":2,"id":"実際の運用例"},"children":["実際の運用例"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"ci/cdパイプラインとの連携"},"children":["CI/CDパイプラインとの連携"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"yaml"},"children":["# GitHub Actions での通知設定\n- name: Deploy to Production\n  env:\n    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n    SLACK_TOKEN: ${{ secrets.SLACK_TOKEN }}\n  run: |\n    dewy server \\\n      --registry ghr://${{ github.repository }} \\\n      --notifier \"slack://deployments?title=${{ github.repository }}&url=https://github.com/${{ github.repository }}\" \\\n      -- /opt/app/current/app\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"level":3,"id":"監視システムとの連携"},"children":["監視システムとの連携"]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# Datadogなどの監視システムとSlack通知の併用\ndewy server --registry ghr://owner/repo \\\n  --notifier \"slack://ops-alerts?title=MyApp+Production\" \\\n  --after-deploy-hook \"curl -X POST https://api.datadoghq.com/api/v1/events ...\" \\\n  -- /opt/myapp/current/myapp\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["通知機能により、チーム全体でデプロイメント状況を共有し、問題の早期発見と対応が可能になります。適切な通知設定で、効率的な運用体制を構築してください。"]}]},"frontmatter":{"title":"通知","description":"通知機能は、デプロイメントの状況をチームに自動で伝えるDewyのコンポーネントです。\n成功・失敗・フック実行結果など、様々なイベントをSlackやメールで通知できます。\n"},"file":{"path":"/ja/notifier.md"}}},"__N_SSG":true}