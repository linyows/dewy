(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[548],{1176:(n,e,r)=>{"use strict";r.r(e),r.d(e,{__N_SSG:()=>w,default:()=>v,markdoc:()=>m});var t=r(4232),a=r(3423),c=r(3854),s=r(9146),o=r(2665),i=r(3930),p=r(1930);let l={tags:(0,s.X)(o),nodes:(0,s.X)(i),functions:(0,s.X)(p),...(0,s.X)({})},y=new c.Ay.Tokenizer({allowComments:!0}).tokenize('---\ntitle: キャッシュ\ndescription: |\n  キャッシュは、ダウンロード済みアーティファクトを管理し、冗長なネットワークトラフィックを回避するDewyの重要なコンポーネントです。\n  複数のキャッシュストア実装から選択でき、分散環境でのキャッシュ共有も可能です。\n---\n\n# {% $markdoc.frontmatter.title %} {% #overview %}\n\n{% $markdoc.frontmatter.description %}\n\n## 概要 {% #overview-details %}\n\nキャッシュコンポーネントは、Dewyのデプロイプロセスにおいて以下の重要な役割を担います：\n\n- **アーティファクトの保存**: ダウンロードしたバイナリファイルの永続化\n- **バージョン管理**: 現在のバージョン情報の記録と管理\n- **重複ダウンロード防止**: 同一バージョンの再ダウンロードを回避\n- **高速デプロイ**: ローカルキャッシュからの即座な展開\n\nキャッシュは、KVSインターフェースによって抽象化されており、用途に応じて異なる実装を選択できます。\n\n## キャッシュストア実装 {% #cache-stores %}\n\n### ファイルシステム（File）- デフォルト {% #file-cache %}\n\nローカルファイルシステムにアーティファクトを保存する最も基本的な実装です。\n\n**特徴:**\n- 永続的なデータ保存\n- システム再起動後もデータ保持\n- シンプルな設定と管理\n- アーカイブ展開機能を内蔵\n\n**サポートされるアーカイブ形式:**\n- `.tar.gz` / `.tgz`\n- `.tar.bz2` / `.tbz2`\n- `.tar.xz` / `.txz`\n- `.tar`\n- `.zip`\n\n### メモリ（Memory）{% #memory-cache %}\n\n{% callout type="warning" title="未実装" %}\nMemoryキャッシュは現在未実装です。将来のバージョンで対応予定です。\n{% /callout %}\n\nインメモリでアーティファクトを管理する高速な実装（予定）。\n\n**想定される特徴:**\n- 高速なアクセス\n- 揮発性（再起動でデータ消失）\n- メモリ使用量の増加\n\n### HashiCorp Consul {% #consul-cache %}\n\n{% callout type="warning" title="未実装" %}\nConsulキャッシュは現在未実装です。将来のバージョンで対応予定です。\n{% /callout %}\n\n分散環境でのキャッシュ共有を実現する実装（予定）。\n\n**想定される利点:**\n- 複数Dewyインスタンス間でのキャッシュ共有\n- レジストリへのリクエスト削減\n- 分散システムでのレート制限対策\n\n### Redis {% #redis-cache %}\n\n{% callout type="warning" title="未実装" %}\nRedisキャッシュは現在未実装です。将来のバージョンで対応予定です。\n{% /callout %}\n\n高性能な分散キャッシュシステムとの連携実装（予定）。\n\n**想定される特徴:**\n- 高速な分散キャッシュ\n- TTL設定による自動expiration\n- クラスター対応\n\n## キャッシュディレクトリ設定 {% #cache-directory %}\n\nDewyは、以下の優先順位でキャッシュディレクトリを決定します：\n\n### 1. DEWY_CACHEDIR 環境変数（最高優先度）\n\n```sh\nexport DEWY_CACHEDIR=/var/cache/dewy\ndewy server --registry ghr://owner/repo -- /opt/myapp/current/myapp\n```\n\n### 2. カレントディレクトリ + .dewy/cache（デフォルト）\n\n```sh\n# /opt/myapp/.dewy/cache が使用される\ncd /opt/myapp\ndewy server --registry ghr://owner/repo -- ./current/myapp\n```\n\n### 3. 一時ディレクトリ（フォールバック）\n\nディレクトリ作成に失敗した場合、自動的に一時ディレクトリにフォールバックします。\n\n### systemdでの設定例\n\n{% callout type="note" title="systemd運用のTips" %}\nsystemdでDewyを管理する場合は、`DEWY_CACHEDIR`で専用のキャッシュディレクトリを指定することを推奨します。\n{% /callout %}\n\n```ini\n# /etc/systemd/system/dewy.service\n[Unit]\nDescription=Dewy Application Deployment Service\nAfter=network.target\n\n[Service]\nType=simple\nUser=dewy\nGroup=dewy\nEnvironment=DEWY_CACHEDIR=/var/cache/dewy\nExecStart=/usr/local/bin/dewy server --registry ghr://myorg/myapp -- /opt/myapp/current/myapp\nRestart=always\nRestartSec=10\n\n[Install]\nWantedBy=multi-user.target\n```\n\n事前にディレクトリとアクセス権を設定：\n\n```sh\nsudo mkdir -p /var/cache/dewy\nsudo chown dewy:dewy /var/cache/dewy\nsudo chmod 755 /var/cache/dewy\n```\n\n### Docker環境での設定\n\n```sh\n# 永続ボリュームでキャッシュを保持\ndocker run -d \\\n  -e DEWY_CACHEDIR=/app/cache \\\n  -v /host/dewy-cache:/app/cache \\\n  dewy:latest server --registry ghr://owner/repo -- /opt/app/current/app\n```\n\n## キャッシュキーの仕組み {% #cache-keys %}\n\nDewyは、以下のキー構造でキャッシュを管理します：\n\n### currentキー\n\n現在実行中のアプリケーションバージョンを示すspecialキーです。\n\n```sh\n# ファイルキャッシュの場合\ncat /var/cache/dewy/current\n# 出力例: v1.2.3--app_linux_amd64.tar.gz\n```\n\nこの値は、実際のアーティファクトファイルを参照するキャッシュキーとして使用されます。\n\n### アーティファクトキー\n\nバージョンタグとアーティファクト名を組み合わせた形式：\n\n```\n{version}--{artifact_name}\n```\n\n**例:**\n- `v1.2.3--myapp_linux_amd64.tar.gz`\n- `v2.0.0-rc.1--myapp_darwin_arm64.zip`\n\n## パフォーマンス最適化 {% #performance %}\n\n### レート制限対策\n\n複数のDewyインスタンスを運用する場合、以下の戦略でレジストリへのリクエストを削減できます：\n\n```sh\n# ポーリング間隔を長くする（デフォルト: 10秒）\ndewy server --registry ghr://owner/repo \\\n  --interval 60s -- /opt/myapp/current/myapp\n\n# 将来的には分散キャッシュ（Consul/Redis）でキャッシュ共有\n# dewy server --registry ghr://owner/repo \\\n#   --cache consul://localhost:8500 \\\n#   --interval 30s -- /opt/myapp/current/myapp\n```\n\n### ストレージ管理\n\n```sh\n# キャッシュサイズの制限（デフォルト: 64MB）\n# 現在はファイルキャッシュのディレクトリサイズで判定\ndu -sh /var/cache/dewy\n```\n\n## 運用ガイド {% #operations %}\n\n### トラブルシューティング\n\n**キャッシュミスが頻発する場合:**\n\n```sh\n# キャッシュディレクトリの確認\nls -la $DEWY_CACHEDIR\n\n# currentキーの確認\ncat $DEWY_CACHEDIR/current\n\n# 権限の確認\nls -la $DEWY_CACHEDIR\n```\n\n**権限エラーの場合:**\n\n```sh\n# ディレクトリ権限の修正\nsudo chown -R dewy:dewy /var/cache/dewy\nsudo chmod -R 755 /var/cache/dewy\n```\n\n**ディスク容量不足の場合:**\n\n```sh\n# キャッシュディスクtリの使用量確認\ndf -h /var/cache/dewy\n\n# 古いキャッシュファイルの手動削除\nfind /var/cache/dewy -name "v*" -mtime +7 -delete\n```\n\n### モニタリング\n\n**キャッシュ利用状況の確認:**\n\n```sh\n# キャッシュファイル一覧\nls -la /var/cache/dewy/\n\n# 現在のバージョン確認\ncat /var/cache/dewy/current\n\n# ログでキャッシュアクセスを監視\njournalctl -u dewy.service -f | grep -i cache\n```\n\n## 設定例とベストプラクティス {% #best-practices %}\n\n### 本番環境での推奨設定\n\n```sh\n# systemd環境\nEnvironment=DEWY_CACHEDIR=/var/cache/dewy\n\n# 適切なポーリング間隔\n--interval 30s\n\n# 構造化ログでモニタリング\n--log-format json\n```\n\n### 開発環境での軽量設定\n\n```sh\n# プロジェクトディレクトリでの実行\ncd /path/to/myproject\ndewy server --registry ghr://owner/repo \\\n  --interval 5s \\\n  --log-format text -- ./current/myapp\n```\n\n### 高可用性構成での戦略\n\n将来の分散キャッシュ対応時の想定設定：\n\n```sh\n# 複数インスタンスでConsulキャッシュ共有（予定）\n# dewy server --registry ghr://owner/repo \\\n#   --cache consul://consul-cluster:8500 \\\n#   --interval 60s -- /opt/myapp/current/myapp\n```\n\n## 関連項目 {% #related %}\n\n- [アーキテクチャ](/ja/architecture) - Dewyの全体構成とキャッシュの位置づけ\n- [レジストリ](/ja/registry) - アーティファクトの取得元設定\n- [FAQ](/ja/faq) - キャッシュ関連のよくある質問'),d=c.Ay.parse(y,{slots:!1}),u=d.attributes.frontmatter?a.Ay.load(d.attributes.frontmatter):{},{components:h}=(0,s._)(l);var w=!0;let m={frontmatter:u};function v(n){let e=n.markdoc;return c.ZR.react(e.content,t,{components:{...h,...n.components}})}},1930:(n,e,r)=>{"use strict";r.r(e),r.d(e,{includes:()=>t,upper:()=>a});let t={transform(n){let[e,r]=Object.values(n);return!!Array.isArray(e)&&e.includes(r)}},a={transform(n){let e=n[0];return"string"==typeof e?e.toUpperCase():e}}},2665:(n,e,r)=>{"use strict";r.r(e),r.d(e,{callout:()=>t});let t={render:r(9499).Pq,children:["paragraph","tag","list"],attributes:{type:{type:String,default:"note",matches:["tip","note","important","warning","caution"],errorLevel:"critical"},title:{type:String}}}},3930:(n,e,r)=>{"use strict";r.r(e),r.d(e,{fence:()=>c,heading:()=>s,table:()=>o});var t=r(3854),a=r(9499);let c={render:a.NG,attributes:t.a9.fence.attributes},s={render:a.DZ,children:["inline"],attributes:{id:{type:String},level:{type:Number,required:!0,default:1},className:{type:String}},transform(n,e){let r=n.transformAttributes(e),a=n.transformChildren(e),c=r.id&&"string"==typeof r.id?r.id:a.filter(n=>"string"==typeof n).join(" ").replace(/[?]/g,"").replace(/\s+/g,"-").toLowerCase();return new t.vw(this.render,{...r,id:c},a)}},o={render:a.XI,attributes:t.a9.table.attributes}},9374:(n,e,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/ja/cache",function(){return r(1176)}])}},n=>{n.O(0,[849,454,636,593,792],()=>n(n.s=9374)),_N_E=n.O()}]);