<!DOCTYPE html><html><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width, initial-scale=1.0" class="jsx-2c089a125ba37756" data-next-head=""/><title class="jsx-2c089a125ba37756" data-next-head="">デプロイメントフック</title><meta name="referrer" content="strict-origin" class="jsx-2c089a125ba37756" data-next-head=""/><meta name="title" content="デプロイメントフック" class="jsx-2c089a125ba37756" data-next-head=""/><meta name="description" content="デプロイメントフックは、デプロイの前後にカスタムコマンドを実行する機能です。
データベースバックアップ、サービス管理、通知送信など、デプロイプロセスを柔軟にカスタマイズできます。
" class="jsx-2c089a125ba37756" data-next-head=""/><link rel="shortcut icon" href="/favicon.ico" class="jsx-2c089a125ba37756" data-next-head=""/><link rel="icon" href="/favicon.ico" class="jsx-2c089a125ba37756" data-next-head=""/><link rel="preload" href="/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/e0b9878176701ca7-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/84bfe6d1aac6b83d-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/f70d40ede2331cb0-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/01bba500e443ead6-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/32b775646a19d186-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/eea397043c200891-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/67f47cb6a2b63f07-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/9158b68cd5c45e38-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/ec04e7e6979abdda-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/c46033e0fb4ee5c9-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/6b41de40682c5c38-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/28f3ed30228da5bb-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/cb22c0e8f9e82937-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/77a0851e226c8f04-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/e1d8b89e7cf76c8e-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/eb64724a8aebd87f-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/cd204eea4ca0abc6-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/b6b2f8c01e307499-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/222a582a9cdae510-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/b572e57261516446-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/7042d5bcecf89f8c-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/de273181474d2813-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/f3005551de15e373-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/382d4fbc23a27406-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/95beb20df42cda78-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/ac9dd72a3a4c73a2-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/bb92738d7c53cd02-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/09cb492dce66648a-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/d5b7944cedcedec9-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/61f168a312a9a6fd-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/ff419b4722859e2b-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/ca76450c075e6148-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/702b2167f98ded41-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/e36af0c058456356-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/989711024ddf3fe7-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/4b4d3edfa10eed0e-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/de715dba495f70a1-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/37ddae4af3807caf-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/954dae2919a8ef23-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/63bc44aad7bf193d-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/8f6c875c2ecfb475-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/e3396146f09fb115-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/3b3a0ac5d15ebe81-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/31517b0a23d225b6-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/0bea5582b826a3a9-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/1ef5e7060da91c6d-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/ddfce144a528a271-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/12301927772c0f98-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/c857ba332d37be6a-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/b85ff18fd14c0ab4-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/e88ba531fabaca80-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/17a3ce3c21648956-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/f5421eeef4189c37-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/ae79ae272cbe4202-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/d708ad08fa04841a-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/77bf915524f243c4-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/66ea918c2ec9465b-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/9d5bf8730ca3045a-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/27941a1ea8d6a630-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/202cd44a24476da3-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/bcafa103e7ac9fa4-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/7af75f77c82ac950-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/1520f3a81010f27b-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/7ff005109ff2ebea-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/889a412a1e9d9de1-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/9e36fab97bf9ede3-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/263936156ee881af-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/44a6ee3eb27bca4f-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/3b520911d44476e3-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/7e31b4d09344bbd0-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/4216a3e6e750c567-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/d3e42231e76d3885-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/b5eb3ad44ecb40b0-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/9a50d1073ba0bffb-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/3d3260a829bfac08-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/172664975e78d11d-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/b85d4546bd81d0fb-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/0065e538e98ef630-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/b146731d3ed7c730-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/c93ac48c632a8cb5-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/cef3cec989800ca6-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/9ee7df94149cd41a-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/4198ad124ed0b09d-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/d7cf6f033041d7cd-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/5748c3ff735709c2-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/cf063972e7593a78-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/3206b244a0f8106f-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/8a4560b4ff0542af-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/83c50cf02b32fdc2-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/1b858adb15a1e310-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/2048cc6731c3cc81-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/a67418c01502bb81-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/8603985959c012b1-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/dc33c53ade954992-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/b2d037c2e387c1b4-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/bef97592dcd6aeb9-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/7646e0899ea6fdd4-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/06b6b4b1b4384386-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/eb452287b67d0e41-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/99b3bf093c004af1-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/68ee6105dd4c0bef-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/11de988ab1b772fe-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/2a7178f3866c720c-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/946c5c05d8cc2dbc-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/7afed0e364a7a81a-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/6e137e69fc4bfc84-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/f8840f041d414b8d-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/c25dbe155b5ea0b6-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/72f4bbd76e868a87-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/e763f383172adc86-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/f30ad6e1b4d5f3fe-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/f748a76b77e317d0-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/a95d9fb33d95b36a-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/acb4ca76d265d486-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/32ab0016806482fd-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/4c41b4c1ed5983ca-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/c4c03e7bcd5f01b3-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/acdbf9278815524d-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/c9610d9e6023b3d7-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/media/e96f2715c0abc107-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/_next/static/css/c5f00cf08e68820f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c5f00cf08e68820f.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-8cac0b4b405cede1.js" defer=""></script><script src="/_next/static/chunks/framework-b1e5f14688f9ffe6.js" defer=""></script><script src="/_next/static/chunks/main-8670b68f6fc4eb08.js" defer=""></script><script src="/_next/static/chunks/pages/_app-d27cac69e1d3f6f4.js" defer=""></script><script src="/_next/static/chunks/430d785c-4072b95d016b9e85.js" defer=""></script><script src="/_next/static/chunks/454-8e5b2712a1669ab8.js" defer=""></script><script src="/_next/static/chunks/pages/ja/deployment-hooks-9e614ae381bc82db.js" defer=""></script><script src="/_next/static/nrvWMDTFmOrVmYO9xH7ns/_buildManifest.js" defer=""></script><script src="/_next/static/nrvWMDTFmOrVmYO9xH7ns/_ssgManifest.js" defer=""></script><style id="__jsx-253391f3484df3c2">.logo-icon.jsx-253391f3484df3c2{display:inline-block;border-radius:8px;background:var(--primary-color);fill:#fff;width:40px;height:40px;overflow:hidden;padding:10px}.logo-font.jsx-253391f3484df3c2{display:inline-block;width:100px;height:36px;margin-left:20px;vertical-align:top;fill:var(--primary-color);margin-top:2px}nav.jsx-253391f3484df3c2{top:0;position:fixed;width:100%;z-index:100;display:flex;align-items:center;gap:1rem;padding:1.5rem 2.5rem;backdrop-filter:blur(5px)}nav.jsx-253391f3484df3c2 a{text-decoration:none}.logo.jsx-253391f3484df3c2{flex-shrink:0;margin-right:5rem}section.jsx-253391f3484df3c2{display:flex;gap:2rem;padding:0 1rem 0 0;flex-grow:1;justify-content:flex-end}button.jsx-253391f3484df3c2{background:none;padding:.2rem .6rem;border-radius:4px;border:1px solid rgba(23,23,22,.4);margin:-3px 0 0 1rem;cursor:pointer;display:flex;align-items:center;line-height:1;outline:2px solid transparent
            outline-offset: 2px;box-shadow:0 0#0000,0 0#0000,0 0#0000;background-image:linear-gradient(to bottom,#fff,#f9f9f9)}button.jsx-253391f3484df3c2 p.jsx-253391f3484df3c2{margin:0}.lang.jsx-253391f3484df3c2{width:1.4rem;height:1.4rem;fill:var(--primary-color);margin:0 .4rem 0 0}.toggle.jsx-253391f3484df3c2{width:.8rem;margin-left:.4rem;vertical-align:bottom}.github.jsx-253391f3484df3c2{width:1.6rem;height:1.6rem;fill:var(--text-color);margin-left:1rem;cursor:pointer}.nav-link-icon.jsx-253391f3484df3c2{width:20px;height:20px;fill:var(--primary-color);display:inline-block;vertical-align:top;margin:2px .5rem 0 0}.nav-link.jsx-253391f3484df3c2 a.jsx-253391f3484df3c2{color:var(--primary-color)}</style><style id="__jsx-ceaad09f8882a4d6">nav.jsx-ceaad09f8882a4d6{position:sticky;top:var(--top-nav-height);max-height:var(--top-nav-height);flex:0 0 auto;padding:3rem 2.5rem 2.5rem var(--side-width)}span.jsx-ceaad09f8882a4d6{font-weight:bold;padding:.5rem 0 .5rem 1.6rem;poisition:relative}span.jsx-ceaad09f8882a4d6:before{content:"⏺";display:block;position:absolute;font-size:1.4rem;line-height:1.4rem;color:var(--primary-color)}ul.jsx-ceaad09f8882a4d6{padding:0 0 1.5rem 1.7rem;position:relative}ul.jsx-ceaad09f8882a4d6:before{content:"⎿";position:absolute;left:-.1rem;top:0;bottom:0;width:1px}li.jsx-ceaad09f8882a4d6{list-style:none;margin:0;padding:.4rem 0}li.jsx-ceaad09f8882a4d6 a{text-decoration:none}li.jsx-ceaad09f8882a4d6 a:hover,li.active.jsx-ceaad09f8882a4d6 a{text-decoration:underline}</style><style id="__jsx-434bf32da6e3c1fb">.code-block.jsx-434bf32da6e3c1fb{width:100%;position:relative;top:0;left:0;-webkit-overflow-scrolling:touch;max-width:100%;min-width:var(--min-width);margin:1rem 0}.code-block.jsx-434bf32da6e3c1fb pre[class*="language-"]{text-shadow:none;border-radius:4px;font-size:.85rem;padding:1.2rem 1.5rem;width:100%;overflow:auto;background-color:rgba(170,170,170,.1);border:1px solid var(--text-dim-color);box-shadow:5px 5px 1px rgba(0,0,0,.1)}.code-block.jsx-434bf32da6e3c1fb code.jsx-434bf32da6e3c1fb{white-space:pre;word-wrap:break-word;width:100%}</style><style id="__jsx-72fb50a247bdd974">.type-name.jsx-72fb50a247bdd974 svg{width:20px;height:20px;margin-right:.4rem;vertical-align:bottom}.type-name.note.jsx-72fb50a247bdd974 svg{color:var(--note-color);fill:var(--note-color)}.type-name.tip.jsx-72fb50a247bdd974 svg{color:var(--tip-color);fill:var(--tip-color)}.type-name.important.jsx-72fb50a247bdd974 svg{color:var(--important-color);fill:var(--important-color)}.type-name.warning.jsx-72fb50a247bdd974 svg{color:var(--warning-color);fill:var(--warning-color)}.type-name.caution.jsx-72fb50a247bdd974 svg{color:var(--caution-color);fill:var(--caution-color)}.type-name.jsx-72fb50a247bdd974{position:absolute;top:-.9rem;left:1rem;background-color:inherit;padding:0 .5rem;text-transform:capitalize}.callout.jsx-72fb50a247bdd974{display:flex;flex-direction:column;padding:1.2rem 1.5rem 1.2rem 3.4rem;background:#fff;border:1px solid#dce6e9;border-radius:4px;margin:2rem 0;position:relative;box-shadow:5px 5px 1px rgba(0,0,0,.1)}.callout.jsx-72fb50a247bdd974 p{margin:0;font-size:.95rem;line-height:1.75}.callout.note.jsx-72fb50a247bdd974{color:var(--note-color);border-color:var(--note-color)}.callout.tip.jsx-72fb50a247bdd974{color:var(--tip-color);border-color:var(--tip-color)}.callout.important.jsx-72fb50a247bdd974{color:var(--important-color);border-color:var(--important-color)}.callout.warning.jsx-72fb50a247bdd974{color:var(--warning-color);border-color:var(--warning-color)}.callout.caution.jsx-72fb50a247bdd974{color:var(--caution-color);border-color:var(--caution-color)}</style><style id="__jsx-44358eead9ecd4ea">.table.jsx-44358eead9ecd4ea{display:block;padding:1rem 0;max-width:100%;min-width:var(--min-width);overflow-x:auto;-webkit-overflow-scrolling:touch}.table.jsx-44358eead9ecd4ea table.jsx-44358eead9ecd4ea{width:100%;border-collapse:collapse;table-layout:fixed;overflow:auto}.table.jsx-44358eead9ecd4ea caption.jsx-44358eead9ecd4ea{caption-side:top;text-align:left;font-weight:600;margin-bottom:.5rem}.table.jsx-44358eead9ecd4ea tr{vertical-align:top}.table.jsx-44358eead9ecd4ea th{font-weight:600;background:var(--secondary-color)}.table.jsx-44358eead9ecd4ea th,.table.jsx-44358eead9ecd4ea td{padding:.5rem 1rem;border:1px solid var(--text-color);vertical-align:top;word-break:break-word;overflow-wrap:anywhere}.striped.jsx-44358eead9ecd4ea tbody.jsx-44358eead9ecd4ea tr.jsx-44358eead9ecd4ea:nth-child(odd){background:var(--primary-color)}.bordered.jsx-44358eead9ecd4ea th.jsx-44358eead9ecd4ea,.bordered.jsx-44358eead9ecd4ea td.jsx-44358eead9ecd4ea{border-width:2px}.dense.jsx-44358eead9ecd4ea th.jsx-44358eead9ecd4ea,.dense.jsx-44358eead9ecd4ea td.jsx-44358eead9ecd4ea{padding:.5rem .75rem}.align-left.jsx-44358eead9ecd4ea th.jsx-44358eead9ecd4ea,.align-left.jsx-44358eead9ecd4ea td.jsx-44358eead9ecd4ea{text-align:left}.align-center.jsx-44358eead9ecd4ea th.jsx-44358eead9ecd4ea,.align-center.jsx-44358eead9ecd4ea td.jsx-44358eead9ecd4ea{text-align:center}.align-right.jsx-44358eead9ecd4ea th.jsx-44358eead9ecd4ea,.align-right.jsx-44358eead9ecd4ea td.jsx-44358eead9ecd4ea{text-align:right}.sticky.jsx-44358eead9ecd4ea thead.jsx-44358eead9ecd4ea th.jsx-44358eead9ecd4ea{position:sticky;top:0;background:white;z-index:1}th[align="left"].jsx-44358eead9ecd4ea,td[align="left"].jsx-44358eead9ecd4ea{text-align:left}th[align="center"].jsx-44358eead9ecd4ea,td[align="center"].jsx-44358eead9ecd4ea{text-align:center}th[align="right"].jsx-44358eead9ecd4ea,td[align="right"].jsx-44358eead9ecd4ea{text-align:right}</style><style id="__jsx-99a567945e15e890">.edit-link.jsx-99a567945e15e890{margin:3rem 0;text-align:left}.edit-link.jsx-99a567945e15e890 a.jsx-99a567945e15e890{text-decoration:underline}.edit-link.jsx-99a567945e15e890 a.jsx-99a567945e15e890:hover{text-decoration:none}</style><style id="__jsx-a80eade5b09af88d">ul.jsx-a80eade5b09af88d{margin:0;padding:.25rem 0 .25rem 2rem;font-size:.9rem}li.jsx-a80eade5b09af88d a{text-decoration:none;padding:.2rem 0}li.jsx-a80eade5b09af88d a:hover,li.active.jsx-a80eade5b09af88d a{text-decoration:underline}</style><style id="__jsx-71cd323cadb53055">nav.jsx-71cd323cadb53055{position:sticky;top:calc(2.5rem + var(--top-nav-height));max-height:calc(100vh - var(--top-nav-height));flex:0 0 auto;align-self:flex-start;margin-bottom:1rem;padding:1rem var(--side-width)0 0}.toc-title.jsx-71cd323cadb53055{font-weight:bold;font-size:1.1rem;margin-bottom:1rem}.toc-title.jsx-71cd323cadb53055 svg.jsx-71cd323cadb53055{vertical-align:top;margin-right:.5rem;margin-top:1px}</style><style id="__jsx-2c089a125ba37756">.page.jsx-2c089a125ba37756{top:var(--top-nav-height);display:flex;width:100vw;flex-grow:1}.main-and-toc.jsx-2c089a125ba37756{max-width:1800px;margin:0 auto;flex-grow:1;display:grid;grid-template-columns:minmax(0,1fr)400px;gap:2rem}main.jsx-2c089a125ba37756:before{content:"";position:absolute;top:var(--top-nav-height);left:-1rem;padding:1rem;border-top:1px solid var(--text-color);border-left:1px solid var(--text-color);display:block;width:50px;height:50px;z-index:-1}main.jsx-2c089a125ba37756{flex-grow:1;font-size:16px;padding:var(--top-nav-height)2rem 2rem;position:relative}footer.jsx-2c089a125ba37756{text-align:center;padding:2rem 1rem;font-size:.9rem;color:var(--text-dim-color)}</style></head><body><div id="__next"><nav class="jsx-253391f3484df3c2 __className_eb2f55"><div class="jsx-253391f3484df3c2 logo"><a class="flex" href="/"><span class="jsx-253391f3484df3c2 logo-icon"><svg width="100%" height="100%" viewBox="0 0 50 70" version="1.1" xmlns="http://www.w3.org/2000/svg"><g transform="matrix(0.124353,0,0,0.124096,-88.5641,-158.208)"><path d="M950.551,1304.59C970.369,1389.2 997.522,1422.58 1027.09,1458.97L1027.1,1458.99C1048.52,1485.38 1070.98,1513.18 1093.39,1557.23L1093.4,1557.25C1099.69,1569.63 1104.84,1582.44 1108.44,1595.92C1112.18,1609.92 1114.28,1624.46 1114.28,1639.64C1114.28,1666.92 1109.23,1692.42 1099.28,1716.1L1099.27,1716.13C1089.35,1739.66 1074.61,1761.21 1054.92,1780.66C1054.91,1780.68 1054.89,1780.69 1054.88,1780.71C1035.2,1800.05 1013.53,1814.6 989.887,1824.39L989.87,1824.39C966.107,1834.22 940.535,1839.21 913.178,1839.21C885.813,1839.21 860.28,1834.21 836.557,1824.39C812.999,1814.64 791.352,1800.09 771.664,1780.69L771.642,1780.66C751.953,1761.22 737.173,1739.66 727.256,1716.14C717.26,1692.44 712.2,1666.94 712.2,1639.64C712.2,1625.29 714.062,1611.53 717.415,1598.27L717.421,1598.24C720.645,1585.54 725.286,1573.3 731.061,1561.37C753.077,1515.85 776.085,1487.45 798.32,1460.12L798.329,1460.11C828.008,1423.69 856.073,1389.4 875.574,1304.73C880.296,1284.09 900.908,1271.16 921.575,1275.84C921.642,1275.85 921.71,1275.87 921.777,1275.88C936.652,1279.37 947.308,1290.84 950.541,1304.55L950.551,1304.59ZM913.136,1364.86C892.414,1427.4 866.291,1459.5 838.866,1493.16C818.853,1517.75 797.946,1543.18 778.13,1584.15L778.128,1584.16C773.905,1592.88 770.465,1601.81 768.106,1611.1C765.794,1620.25 764.49,1629.74 764.49,1639.64C764.49,1659.67 768.096,1678.41 775.433,1695.8L775.435,1695.81C782.767,1713.2 793.816,1729.05 808.371,1743.43C823.012,1757.86 839.027,1768.8 856.547,1776.05L856.554,1776.05C874.079,1783.31 892.962,1786.9 913.178,1786.9C933.402,1786.9 952.327,1783.31 969.895,1776.05C987.494,1768.76 1003.56,1757.82 1018.21,1743.42C1032.75,1729.05 1043.75,1713.2 1051.08,1695.82C1058.38,1678.43 1061.99,1659.68 1061.99,1639.64C1061.99,1629.15 1060.51,1619.11 1057.92,1609.44L1057.92,1609.43C1055.27,1599.5 1051.42,1590.07 1046.79,1580.95C1026.46,1541.01 1005.93,1515.9 986.508,1491.96C959.212,1458.36 933.787,1427 913.136,1364.86Z"></path></g></svg></span><span class="jsx-253391f3484df3c2 logo-font"><svg width="100%" height="100%" viewBox="0 0 420 74" version="1.1" xmlns="http://www.w3.org/2000/svg"><g transform="matrix(2.07808,0,0,2.07725,-743.13,-581.637)"><g transform="matrix(1,0,0,1,368.479,315.206)"><path d="M0,-35.086C9.063,-34.633 13.508,-28.773 13.336,-17.508C13.617,-5.883 9.195,-0.109 0.07,-0.188L0.07,-5.438C5.305,-5.797 7.695,-9.672 7.242,-17.063C7.367,-25.203 4.953,-29.367 0,-29.555L0,-35.086ZM-10.875,-35.039L-5.508,-35.039L-5.508,0L-10.875,0L-10.875,-35.039Z"></path></g><g transform="matrix(1,0,0,1,429.084,315.183)"><path d="M0,-35.016L12.117,-35.016L12.117,-29.532L0,-29.532L0,-35.016ZM-0.047,-5.696L12.07,-5.696L12.117,-1.711L12.117,0L6.867,0L6.234,-0.024L5.25,0L-0.047,0L-0.047,-5.696ZM-11.836,-35.016L-5.953,-35.016L-5.953,-20.414L-0.07,-20.414L-0.07,-14.789L-5.953,-14.789L-5.953,0L-11.836,0L-11.836,-35.016Z"></path></g><g transform="matrix(1,0,0,1,501.266,315.207)"><path d="M0,-34.993L-2.297,-16.805L-3.609,-16.805L-5.203,-19.102L-6.727,-25.243L-5.555,-35.04L0,-34.993ZM-9.938,-0.024L-4.688,-0.024L-3.398,-8.251L-7.266,-10.548L-12.539,-35.016L-15.305,-35.016L-16.242,-28.055L-9.938,-0.024ZM-18.703,-15.634L-15.984,-9.657L-18.398,0.07L-22.781,0.07L-26.367,-35.04L-21.164,-35.063L-18.703,-15.634Z"></path></g><g transform="matrix(1,0,0,1,553.059,315.183)"><path d="M0,-35.18L6.633,-35.157L0.328,-23.344L-3.047,-29.344L0,-35.18ZM-17.742,-35.18L-11.18,-35.18L-2.273,-18.305L-2.32,0L-8.742,0L-8.859,-17.649L-17.742,-35.18Z"></path></g></g></svg></span></a></div><section class="jsx-253391f3484df3c2"><div class="jsx-253391f3484df3c2"><a class="nav-link" href="/ja/introduction/"><span class="jsx-253391f3484df3c2 nav-link-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m23.414,14.5l-3.5-3.5h-6.914v-2h9V2h-9.007l.007-1.996-2-.008-.008,2.004h-6.907L.586,5.5l3.5,3.5h6.914v2H2v7h8.99l.01,6.001,2-.003-.01-5.999h6.924l3.5-3.5ZM3.414,5.5l1.5-1.5h15.086v3H4.914l-1.5-1.5Zm.586,10.5v-3h15.086l1.5,1.5-1.5,1.5H4Z"></path></svg></span>ガイド</a></div><div class="jsx-253391f3484df3c2"><a class="nav-link" href="/ja/architecture/"><span class="jsx-253391f3484df3c2 nav-link-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m18 5.086-5.086-5.086h-7.914a3 3 0 0 0 -3 3v17h16zm-14 12.914v-15a1 1 0 0 1 1-1h7v4h4v12zm18-9v15h-15v-2h13v-15z"></path></svg></span>ドキュメント</a></div><div class="jsx-253391f3484df3c2"><a class="nav-link" href="/ja/reference/"><span class="jsx-253391f3484df3c2 nav-link-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.257,8.153c-.962-.462-2.13,.205-2.325,1.236l-1.29,5.612h1.583l.24-.994h2.148l.221,.994h1.667l-1.266-5.572c-.128-.584-.494-1.061-.978-1.276Zm-1.407,4.254l.646-2.678c.019-.068,.05-.122,.097-.122,.014,.01,.057,.063,.082,.176l.583,2.624h-1.407Zm4.15-2.006h2v1.6h-2v-1.6Zm3-2.4h4.55v1.715l-2.562,3.686h2.562v1.6h-4.55v-1.715l2.562-3.686h-2.562v-1.6ZM22.922,1.697c-.686-.571-1.583-.809-2.458-.647l-6.181,1.123c-.912,.166-1.705,.634-2.283,1.288-.578-.654-1.371-1.122-2.284-1.288L3.537,1.05C1.755,.679-.044,2.184,0,4.001V20.835l12,2.182,12-2.182V4.001c0-.893-.393-1.732-1.078-2.304Zm-.922,17.468l-9,1.637v-3.802h-2v3.802l-9-1.637V4.001c.113-.758,.415-1.008,1.179-.984l6.179,1.123c.952,.174,1.643,1.001,1.643,1.968v.893h2v-.893c0-.967,.69-1.794,1.642-1.967l6.181-1.124c.765-.022,1.064,.226,1.178,.984v15.164Z"></path></svg></span>リファレンス</a></div><a href="https://github.com/linyows/dewy" target="_blank" rel="noopener noreferrer" aria-label="GitHub" class="jsx-253391f3484df3c2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="jsx-253391f3484df3c2 github"><path d="M237.9 461.4C237.9 463.4 235.6 465 232.7 465C229.4 465.3 227.1 463.7 227.1 461.4C227.1 459.4 229.4 457.8 232.3 457.8C235.3 457.5 237.9 459.1 237.9 461.4zM206.8 456.9C206.1 458.9 208.1 461.2 211.1 461.8C213.7 462.8 216.7 461.8 217.3 459.8C217.9 457.8 216 455.5 213 454.6C210.4 453.9 207.5 454.9 206.8 456.9zM251 455.2C248.1 455.9 246.1 457.8 246.4 460.1C246.7 462.1 249.3 463.4 252.3 462.7C255.2 462 257.2 460.1 256.9 458.1C256.6 456.2 253.9 454.9 251 455.2zM316.8 72C178.1 72 72 177.3 72 316C72 426.9 141.8 521.8 241.5 555.2C254.3 557.5 258.8 549.6 258.8 543.1C258.8 536.9 258.5 502.7 258.5 481.7C258.5 481.7 188.5 496.7 173.8 451.9C173.8 451.9 162.4 422.8 146 415.3C146 415.3 123.1 399.6 147.6 399.9C147.6 399.9 172.5 401.9 186.2 425.7C208.1 464.3 244.8 453.2 259.1 446.6C261.4 430.6 267.9 419.5 275.1 412.9C219.2 406.7 162.8 398.6 162.8 302.4C162.8 274.9 170.4 261.1 186.4 243.5C183.8 237 175.3 210.2 189 175.6C209.9 169.1 258 202.6 258 202.6C278 197 299.5 194.1 320.8 194.1C342.1 194.1 363.6 197 383.6 202.6C383.6 202.6 431.7 169 452.6 175.6C466.3 210.3 457.8 237 455.2 243.5C471.2 261.2 481 275 481 302.4C481 398.9 422.1 406.6 366.2 412.9C375.4 420.8 383.2 435.8 383.2 459.3C383.2 493 382.9 534.7 382.9 542.9C382.9 549.4 387.5 557.3 400.2 555C500.2 521.8 568 426.9 568 316C568 177.3 455.5 72 316.8 72zM169.2 416.9C167.9 417.9 168.2 420.2 169.9 422.1C171.5 423.7 173.8 424.4 175.1 423.1C176.4 422.1 176.1 419.8 174.4 417.9C172.8 416.3 170.5 415.6 169.2 416.9zM158.4 408.8C157.7 410.1 158.7 411.7 160.7 412.7C162.3 413.7 164.3 413.4 165 412C165.7 410.7 164.7 409.1 162.7 408.1C160.7 407.5 159.1 407.8 158.4 408.8zM190.8 444.4C189.2 445.7 189.8 448.7 192.1 450.6C194.4 452.9 197.3 453.2 198.6 451.6C199.9 450.3 199.3 447.3 197.3 445.4C195.1 443.1 192.1 442.8 190.8 444.4zM179.4 429.7C177.8 430.7 177.8 433.3 179.4 435.6C181 437.9 183.7 438.9 185 437.9C186.6 436.6 186.6 434 185 431.7C183.6 429.4 181 428.4 179.4 429.7z" class="jsx-253391f3484df3c2"></path></svg></a><button type="button" aria-haspopup="menu" aria-expanded="false" data-state="closed" class="jsx-253391f3484df3c2 "><svg xmlns="http://www.w3.org/2000/svg" width="640" height="640" viewBox="0 0 640 640" fill="none" stroke="currentColor" stroke-width="2" class="jsx-253391f3484df3c2 lang"><path d="M192 64C209.7 64 224 78.3 224 96L224 128L352 128C369.7 128 384 142.3 384 160C384 177.7 369.7 192 352 192L342.4 192L334 215.1C317.6 260.3 292.9 301.6 261.8 337.1C276 345.9 290.8 353.7 306.2 360.6L356.6 383L418.8 243C423.9 231.4 435.4 224 448 224C460.6 224 472.1 231.4 477.2 243L605.2 531C612.4 547.2 605.1 566.1 589 573.2C572.9 580.3 553.9 573.1 546.8 557L526.8 512L369.3 512L349.3 557C342.1 573.2 323.2 580.4 307.1 573.2C291 566 283.7 547.1 290.9 531L330.7 441.5L280.3 419.1C257.3 408.9 235.3 396.7 214.5 382.7C193.2 399.9 169.9 414.9 145 427.4L110.3 444.6C94.5 452.5 75.3 446.1 67.4 430.3C59.5 414.5 65.9 395.3 81.7 387.4L116.2 370.1C132.5 361.9 148 352.4 162.6 341.8C148.8 329.1 135.8 315.4 123.7 300.9L113.6 288.7C102.3 275.1 104.1 254.9 117.7 243.6C131.3 232.3 151.5 234.1 162.8 247.7L173 259.9C184.5 273.8 197.1 286.7 210.4 298.6C237.9 268.2 259.6 232.5 273.9 193.2L274.4 192L64.1 192C46.3 192 32 177.7 32 160C32 142.3 46.3 128 64 128L160 128L160 96C160 78.3 174.3 64 192 64zM448 334.8L397.7 448L498.3 448L448 334.8z" class="jsx-253391f3484df3c2"></path></svg><p class="jsx-253391f3484df3c2">言語</p><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="jsx-253391f3484df3c2 toggle"><path d="m6 9 6 6 6-6" class="jsx-253391f3484df3c2"></path></svg></button></section></nav><div class="jsx-2c089a125ba37756 page __className_eb2f55"><nav class="jsx-ceaad09f8882a4d6 sidenav __className_eb2f55"><div class="jsx-ceaad09f8882a4d6"><span class="jsx-ceaad09f8882a4d6">概要</span><ul class="jsx-ceaad09f8882a4d6 flex column"><li class="jsx-ceaad09f8882a4d6 "><a href="/ja/introduction/">はじめに</a></li><li class="jsx-ceaad09f8882a4d6 "><a href="/ja/getting-started/">使ってみよう</a></li><li class="jsx-ceaad09f8882a4d6 "><a href="/ja/installation/">インストール</a></li><li class="jsx-ceaad09f8882a4d6 "><a href="/ja/faq/">よくある質問</a></li><li class="jsx-ceaad09f8882a4d6 "><a href="/ja/contributing/">コントリビューション</a></li></ul></div><div class="jsx-ceaad09f8882a4d6"><span class="jsx-ceaad09f8882a4d6">コンセプト</span><ul class="jsx-ceaad09f8882a4d6 flex column"><li class="jsx-ceaad09f8882a4d6 "><a href="/ja/architecture/">アーキテクチャ</a></li><li class="jsx-ceaad09f8882a4d6 "><a href="/ja/registry/">レジストリー</a></li><li class="jsx-ceaad09f8882a4d6 "><a href="/ja/artifact/">アーティファクト</a></li><li class="jsx-ceaad09f8882a4d6 "><a href="/ja/notifier/">通知</a></li><li class="jsx-ceaad09f8882a4d6 "><a href="/ja/cache/">キャッシュ</a></li><li class="jsx-ceaad09f8882a4d6 "><a href="/ja/versioning/">バージョニング</a></li><li class="jsx-ceaad09f8882a4d6 active"><a href="/ja/deployment-hooks/">デプロイフック</a></li></ul></div><div class="jsx-ceaad09f8882a4d6"><span class="jsx-ceaad09f8882a4d6">運用</span><ul class="jsx-ceaad09f8882a4d6 flex column"><li class="jsx-ceaad09f8882a4d6 "><a href="/ja/signal-handling/">シグナルハンドリング</a></li><li class="jsx-ceaad09f8882a4d6 "><a href="/ja/multi-port/">マルチポート</a></li><li class="jsx-ceaad09f8882a4d6 "><a href="/ja/structured-logging/">構造化ログ</a></li><li class="jsx-ceaad09f8882a4d6 "><a href="/ja/cache-configuration/">キャッシュ設定</a></li><li class="jsx-ceaad09f8882a4d6 "><a href="/ja/deployment-workflow/">デプロイメントワークフロー</a></li></ul></div></nav><div class="jsx-2c089a125ba37756 main-and-toc"><main class="jsx-2c089a125ba37756 flex column"><article class="jsx-99a567945e15e890"><article><h1 id="overview" class="heading">デプロイメントフック<!-- --> </h1><p>デプロイメントフックは、デプロイの前後にカスタムコマンドを実行する機能です。
データベースバックアップ、サービス管理、通知送信など、デプロイプロセスを柔軟にカスタマイズできます。
</p><h2 id="overview-details" class="heading">概要 </h2><p>デプロイメントフックは、Dewyの自動デプロイプロセスをカスタマイズするための強力な機能です。アプリケーションのデプロイ前後に任意のシェルコマンドを実行でき、データベースの操作、外部サービスとの連携、検証処理など、様々な用途に活用できます。</p><p><strong>主な特徴:</strong></p><ul><li><strong>柔軟な実行タイミング</strong>: デプロイ前後での実行制御</li><li><strong>完全な環境アクセス</strong>: 環境変数とファイルシステムへのフルアクセス</li><li><strong>詳細な実行結果</strong>: stdout/stderr、終了コード、実行時間の記録</li><li><strong>通知連携</strong>: 設定済み通知チャネルへの実行結果送信</li></ul><h2 id="hook-types" class="heading">フックの種類と動作 </h2><h3 id="before-hook" class="heading">Before Deploy Hook </h3><p>デプロイが開始される<strong>前</strong>に実行されるフックです。</p><p><strong>実行タイミング:</strong></p><ul><li>アーティファクトダウンロード後</li><li>ファイル展開とシンボリックリンク作成前</li><li>アプリケーション再起動前</li></ul><p><strong>重要な動作:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># Before Hookが失敗した場合、デプロイは中止される
dewy server --registry ghr://owner/repo \
  --before-deploy-hook &quot;scripts/pre-check.sh&quot; \
  -- /opt/myapp/current/myapp
</code></pre></div><div class="jsx-72fb50a247bdd974 callout warning"><span class="jsx-72fb50a247bdd974 type-name warning"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m23.121,6.151L17.849.878c-.567-.566-1.321-.878-2.121-.878h-7.455c-.8,0-1.554.312-2.122.879L.879,6.151c-.566.567-.879,1.32-.879,2.121v7.456c0,.801.312,1.554.879,2.121l5.272,5.273c.567.566,1.321.878,2.121.878h7.455c.8,0,1.554-.312,2.122-.879l5.271-5.272c.566-.567.879-1.32.879-2.121v-7.456c0-.801-.313-1.554-.879-2.121Zm-1.121,9.577c0,.263-.106.521-.293.707l-5.271,5.271c-.19.189-.442.294-.709.294h-7.455c-.267,0-.519-.104-.708-.293l-5.271-5.272c-.187-.187-.293-.444-.293-.707v-7.456c0-.263.106-.521.293-.707L7.563,2.294c.19-.189.442-.294.709-.294h7.455c.267,0,.519.104.708.293l5.271,5.272c.187.187.293.444.293.707v7.456Zm-9-2.728h-2v-7h2v7Zm.5,3.5c0,.828-.672,1.5-1.5,1.5s-1.5-.672-1.5-1.5.672-1.5,1.5-1.5,1.5.672,1.5,1.5Z"></path></svg> <!-- -->warning</span><strong class="jsx-72fb50a247bdd974">デプロイ中止の条件</strong><span class="jsx-72fb50a247bdd974"><p>Before Deploy Hookが0以外の終了コードで終了した場合、デプロイプロセス全体が中止されます。<!-- --> <!-- -->この動作により、事前条件が満たされていない場合の安全なデプロイ防止が可能です。</p></span></div><h3 id="after-hook" class="heading">After Deploy Hook </h3><p>デプロイが<strong>成功</strong>した後に実行されるフックです。</p><p><strong>実行タイミング:</strong></p><ul><li>ファイル展開とシンボリックリンク作成完了後</li><li>アプリケーション再起動完了後（server コマンドの場合）</li><li>デプロイプロセスの最終段階</li></ul><p><strong>重要な動作:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># After Hookが失敗してもデプロイは成功として扱われる
dewy server --registry ghr://owner/repo \
  --after-deploy-hook &quot;scripts/post-deploy-validation.sh&quot; \
  -- /opt/myapp/current/myapp
</code></pre></div><div class="jsx-72fb50a247bdd974 callout note"><span class="jsx-72fb50a247bdd974 type-name note"><svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 24 24"><path d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm0,22A10,10,0,1,1,22,12,10.011,10.011,0,0,1,12,22Z"></path><path d="M12,10H11a1,1,0,0,0,0,2h1v6a1,1,0,0,0,2,0V12A2,2,0,0,0,12,10Z"></path><circle cx="12" cy="6.5" r="1.5"></circle></svg> <!-- -->note</span><strong class="jsx-72fb50a247bdd974"></strong><span class="jsx-72fb50a247bdd974"><p>After Deploy Hookの失敗はデプロイの成功ステータスに影響しません。<!-- --> <!-- -->ただし、エラーはログに記録され、設定されている場合は通知が送信されます。</p></span></div><h2 id="execution-environment" class="heading">実行環境と制約 </h2><h3 id="environment" class="heading">実行環境 </h3><p>フックは以下の環境で実行されます：</p><p><strong>シェル実行:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code">/bin/sh -c &quot;your-command&quot;
</code></pre></div><p><strong>作業ディレクトリ:</strong></p><ul><li>Dewyの実行ディレクトリ（通常はアプリケーションのルートディレクトリ）</li></ul><p><strong>環境変数:</strong></p><ul><li>Dewyプロセスのすべての環境変数を継承</li><li>実行時の環境変数へのフルアクセス</li></ul><h3 id="execution-results" class="heading">実行結果の取得 </h3><p>フック実行時に以下の情報が記録されます：</p><div class="jsx-44358eead9ecd4ea table"><table class="jsx-44358eead9ecd4ea align-left"><thead><tr><th>項目</th><th>説明</th><th>用途</th></tr></thead><tbody><tr><td>Command</td><td>実行されたコマンド文字列</td><td>デバッグとログ記録</td></tr><tr><td>Stdout</td><td>標準出力の内容</td><td>実行結果の確認</td></tr><tr><td>Stderr</td><td>標準エラー出力</td><td>エラー内容の把握</td></tr><tr><td>ExitCode</td><td>プロセス終了コード</td><td>成功/失敗の判定</td></tr><tr><td>Duration</td><td>実行時間</td><td>パフォーマンス監視</td></tr></tbody></table></div><p><strong>ログ出力例:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-json"><code class="jsx-434bf32da6e3c1fb code">{
  &quot;time&quot;: &quot;2024-03-15T10:30:45Z&quot;,
  &quot;level&quot;: &quot;INFO&quot;,
  &quot;msg&quot;: &quot;Execute hook success&quot;,
  &quot;command&quot;: &quot;backup-database.sh&quot;,
  &quot;stdout&quot;: &quot;Backup completed successfully&quot;,
  &quot;stderr&quot;: &quot;&quot;,
  &quot;exit_code&quot;: 0,
  &quot;duration&quot;: &quot;2.5s&quot;
}
</code></pre></div><h2 id="configuration" class="heading">設定方法 </h2><h3 id="command-line" class="heading">コマンドライン設定 </h3><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># 基本形式
dewy server --registry &lt;registry-url&gt; \
  --before-deploy-hook &quot;&lt;command&gt;&quot; \
  --after-deploy-hook &quot;&lt;command&gt;&quot; \
  -- &lt;application-command&gt;
</code></pre></div><h3 id="configuration-examples" class="heading">設定例 </h3><p><strong>単純なコマンド実行:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code">dewy server --registry ghr://owner/repo \
  --before-deploy-hook &quot;echo &#x27;Starting deployment&#x27;&quot; \
  --after-deploy-hook &quot;echo &#x27;Deployment completed&#x27;&quot; \
  -- /opt/myapp/current/myapp
</code></pre></div><p><strong>複数コマンドの連携:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code">dewy server --registry ghr://owner/repo \
  --before-deploy-hook &quot;systemctl stop nginx &amp;&amp; backup-db.sh&quot; \
  --after-deploy-hook &quot;systemctl start nginx &amp;&amp; send-notification.sh&quot; \
  -- /opt/myapp/current/myapp
</code></pre></div><p><strong>スクリプトファイルの実行:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code">dewy server --registry ghr://owner/repo \
  --before-deploy-hook &quot;/opt/scripts/pre-deploy.sh&quot; \
  --after-deploy-hook &quot;/opt/scripts/post-deploy.sh&quot; \
  -- /opt/myapp/current/myapp
</code></pre></div><h2 id="use-cases" class="heading">実用的なユースケース </h2><h3 id="database-operations" class="heading">データベース操作 </h3><p><strong>バックアップの自動実行:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># PostgreSQL バックアップ
--before-deploy-hook &quot;pg_dump myapp_db &gt; /backup/myapp_$(date +%Y%m%d_%H%M%S).sql&quot;

# MySQL バックアップ
--before-deploy-hook &quot;mysqldump -u root -p myapp_db &gt; /backup/myapp_$(date +%Y%m%d_%H%M%S).sql&quot;
</code></pre></div><p><strong>マイグレーションの実行:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># Rails マイグレーション
--after-deploy-hook &quot;cd /opt/myapp/current &amp;&amp; bundle exec rake db:migrate&quot;

# Django マイグレーション
--after-deploy-hook &quot;cd /opt/myapp/current &amp;&amp; python manage.py migrate&quot;

# Go マイグレーション（migrate ツール使用）
--after-deploy-hook &quot;migrate -path /opt/myapp/current/migrations -database &#x27;postgres://...&#x27; up&quot;
</code></pre></div><h3 id="service-management" class="heading">サービス管理 </h3><p><strong>関連サービスの制御:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># Nginx の一時停止と再開
--before-deploy-hook &quot;systemctl stop nginx&quot;
--after-deploy-hook &quot;systemctl start nginx &amp;&amp; systemctl reload nginx&quot;

# ロードバランサーからの切り離し
--before-deploy-hook &quot;curl -X DELETE http://lb:8080/servers/$(hostname)&quot;
--after-deploy-hook &quot;curl -X POST http://lb:8080/servers/$(hostname)&quot;
</code></pre></div><p><strong>ヘルスチェックの実行:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># アプリケーションの起動確認
--after-deploy-hook &quot;timeout 30 bash -c &#x27;until curl -f http://localhost:8080/health; do sleep 1; done&#x27;&quot;

# データベース接続確認
--before-deploy-hook &quot;pg_isready -h localhost -p 5432 -d myapp_db&quot;
</code></pre></div><h3 id="notification-monitoring" class="heading">通知とモニタリング </h3><p><strong>外部システムへの通知:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># Datadog へのデプロイイベント送信
--after-deploy-hook &quot;curl -X POST https://api.datadoghq.com/api/v1/events \
  -H &#x27;DD-API-KEY: ${DD_API_KEY}&#x27; \
  -d &#x27;{\&quot;title\&quot;:\&quot;Deployment\&quot;,\&quot;text\&quot;:\&quot;App deployed\&quot;}&#x27;&quot;

# PagerDuty への通知
--after-deploy-hook &quot;scripts/notify-pagerduty.sh deployment-success&quot;
</code></pre></div><p><strong>メトリクス収集:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># デプロイ時間の記録
--before-deploy-hook &quot;echo $(date +%s) &gt; /tmp/deploy_start&quot;
--after-deploy-hook &quot;echo &#x27;Deploy time: &#x27;$(($(date +%s) - $(cat /tmp/deploy_start)))&#x27;s&#x27;&quot;
</code></pre></div><h3 id="configuration-management" class="heading">設定とファイル管理 </h3><p><strong>設定ファイルの更新:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># 環境固有の設定適用
--after-deploy-hook &quot;cp /opt/config/production.yml /opt/myapp/current/config.yml&quot;

# テンプレートから設定生成
--after-deploy-hook &quot;envsubst &lt; /opt/templates/app.conf.template &gt; /opt/myapp/current/app.conf&quot;
</code></pre></div><p><strong>キャッシュのクリア:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># Redis キャッシュクリア
--after-deploy-hook &quot;redis-cli FLUSHALL&quot;

# ファイルキャッシュクリア
--after-deploy-hook &quot;rm -rf /opt/myapp/current/tmp/cache/*&quot;

# CDN キャッシュ無効化
--after-deploy-hook &quot;curl -X POST &#x27;https://api.cloudflare.com/client/v4/zones/${ZONE_ID}/purge_cache&#x27; \
  -H &#x27;Authorization: Bearer ${CF_TOKEN}&#x27; -d &#x27;{\&quot;purge_everything\&quot;:true}&#x27;&quot;
</code></pre></div><h2 id="error-handling" class="heading">エラーハンドリングと復旧 </h2><h3 id="before-hook-failure" class="heading">Before Hook失敗時 </h3><p>Before Hookが失敗した場合の動作：</p><ol><li><strong>デプロイの自動中止</strong>: プロセス全体が停止</li><li><strong>エラーログの記録</strong>: 詳細な実行結果をログに出力</li><li><strong>通知の送信</strong>: 設定されている場合、エラー通知を送信</li><li><strong>現在の状態維持</strong>: 既存のアプリケーションは影響を受けない</li></ol><p><strong>推奨される復旧手順:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># 1. エラー原因の確認
tail -f /var/log/dewy.log

# 2. 手動でのフック実行テスト
/bin/sh -c &quot;your-before-hook-command&quot;

# 3. 問題修正後のデプロイ再試行
# Dewyは次回のポーリングで自動的に再試行
</code></pre></div><h3 id="after-hook-failure" class="heading">After Hook失敗時 </h3><p>After Hookが失敗した場合の動作：</p><ol><li><strong>デプロイは成功として処理</strong>: アプリケーションは新バージョンで稼働</li><li><strong>エラーログの記録</strong>: 失敗内容を詳細にログ出力</li><li><strong>通知の送信</strong>: 設定されている場合、警告通知を送信</li><li><strong>手動対応の推奨</strong>: 管理者による確認と対応が必要</li></ol><p><strong>推奨される対応手順:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># 1. 新バージョンの動作確認
curl -f http://localhost:8080/health

# 2. After Hookの手動実行
/bin/sh -c &quot;your-after-hook-command&quot;

# 3. 必要に応じて手動での後処理実行
</code></pre></div><h2 id="security" class="heading">セキュリティ考慮事項 </h2><h3 id="permission-management" class="heading">権限管理 </h3><p><strong>実行ユーザーの権限設定:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># Dewyを専用ユーザーで実行
sudo useradd -r -s /bin/bash dewy
sudo chown -R dewy:dewy /opt/myapp

# 必要最小限の権限でサービス定義
# /etc/systemd/system/dewy.service
[Service]
User=dewy
Group=dewy
</code></pre></div><p><strong>sudo使用時の注意点:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># ❌ 危険：パスワードプロンプトでハング
--before-deploy-hook &quot;sudo systemctl stop nginx&quot;

# ✅ 安全：NOPASSWDまたは専用ユーザー権限設定
--before-deploy-hook &quot;systemctl stop nginx&quot;  # systemd user session
</code></pre></div><h3 id="injection-prevention" class="heading">コマンドインジェクション対策 </h3><p><strong>安全なコマンド記述:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># ✅ 安全：クォートによる保護
--before-deploy-hook &quot;backup-db.sh --name &#x27;myapp_backup&#x27;&quot;

# ❌ 危険：環境変数の直接展開
--before-deploy-hook &quot;echo $USER_INPUT&quot;

# ✅ 安全：環境変数の適切な使用
--before-deploy-hook &quot;scripts/safe-command.sh&quot;  # スクリプト内で適切に処理
</code></pre></div><p><strong>推奨される実装パターン:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code">#!/bin/bash
# scripts/safe-backup.sh
set -euo pipefail

DB_NAME=&quot;${DB_NAME:-myapp}&quot;
BACKUP_DIR=&quot;${BACKUP_DIR:-/backup}&quot;
TIMESTAMP=$(date +%Y%m%d_%H%M%S)

pg_dump &quot;${DB_NAME}&quot; &gt; &quot;${BACKUP_DIR}/backup_${TIMESTAMP}.sql&quot;
</code></pre></div><h2 id="performance-monitoring" class="heading">パフォーマンスと監視 </h2><h3 id="execution-time" class="heading">実行時間の考慮 </h3><p><strong>長時間実行コマンドの対策:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># タイムアウト設定
--before-deploy-hook &quot;timeout 300 large-backup.sh&quot;

# バックグラウンド実行（注意：デプロイ完了を待たない）
--after-deploy-hook &quot;nohup long-running-task.sh &amp;&quot;

# 非同期処理への委譲
--after-deploy-hook &quot;queue-job.sh heavy-processing&quot;
</code></pre></div><h3 id="monitoring-debug" class="heading">監視とデバッグ </h3><p><strong>詳細ログの有効化:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># デバッグレベルでの実行
dewy server --log-format json --log-level debug \
  --registry ghr://owner/repo \
  --before-deploy-hook &quot;verbose-script.sh&quot;
</code></pre></div><p><strong>パフォーマンス測定:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># 実行時間測定付きのフック
--before-deploy-hook &quot;time backup-database.sh&quot;
--after-deploy-hook &quot;time validate-deployment.sh&quot;
</code></pre></div><h2 id="best-practices" class="heading">設定例とベストプラクティス </h2><h3 id="production-settings" class="heading">本番環境での推奨設定 </h3><p><strong>安全なバックアップ戦略:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code">dewy server --registry ghr://company/myapp \
  --before-deploy-hook &quot;scripts/production-backup.sh&quot; \
  --after-deploy-hook &quot;scripts/production-validation.sh&quot; \
  --notifier &quot;slack://ops-alerts&quot; \
  -- /opt/myapp/current/myapp
</code></pre></div><p><strong>production-backup.sh の例:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code">#!/bin/bash
set -euo pipefail

# データベースバックアップ
pg_dump myapp_production &gt; &quot;/backup/pre-deploy-$(date +%Y%m%d_%H%M%S).sql&quot;

# 設定ファイルバックアップ
cp /opt/myapp/current/config.yml &quot;/backup/config-$(date +%Y%m%d_%H%M%S).yml&quot;

# ヘルスチェック
curl -f http://localhost:8080/health || exit 1

echo &quot;Pre-deployment backup completed successfully&quot;
</code></pre></div><h3 id="development-staging" class="heading">開発・ステージング環境 </h3><p><strong>開発効率重視の設定:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code">dewy server --registry &quot;ghr://company/myapp?pre-release=true&quot; \
  --interval 30s \
  --before-deploy-hook &quot;scripts/dev-prepare.sh&quot; \
  --after-deploy-hook &quot;scripts/dev-test.sh&quot; \
  --notifier &quot;slack://dev-deploys&quot; \
  -- /opt/myapp/current/myapp
</code></pre></div><p><strong>自動テスト連携:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code">#!/bin/bash
# scripts/dev-test.sh
set -euo pipefail

# アプリケーション起動待機
sleep 5

# ヘルスチェック
curl -f http://localhost:8080/health

# E2E テスト実行
cd /opt/myapp/current &amp;&amp; npm test

echo &quot;Development validation completed&quot;
</code></pre></div><h2 id="advanced-usage" class="heading">高度な活用例 </h2><h3 id="blue-green" class="heading">Blue-Green デプロイメント </h3><p><strong>トラフィック切り替えの自動化:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># Blue-Green切り替え用のフック設定
dewy server --registry ghr://company/myapp \
  --before-deploy-hook &quot;scripts/prepare-green.sh&quot; \
  --after-deploy-hook &quot;scripts/switch-to-green.sh&quot; \
  -- /opt/myapp/current/myapp
</code></pre></div><p><strong>switch-to-green.sh の例:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code">#!/bin/bash
set -euo pipefail

# Green環境のヘルスチェック
for i in {1..30}; do
  if curl -f http://localhost:8081/health; then
    break
  fi
  sleep 2
done

# ロードバランサーの切り替え
curl -X POST http://lb:8080/switch-to-green

# Blue環境の停止（遅延実行）
sleep 30 &amp;&amp; systemctl stop myapp-blue &amp;

echo &quot;Traffic switched to green environment&quot;
</code></pre></div><h3 id="cicd-integration" class="heading">CI/CDパイプライン連携 </h3><p><strong>GitHub Actions との連携:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># デプロイ完了をGitHub Actionsに通知
--after-deploy-hook &quot;scripts/notify-github-actions.sh&quot;
</code></pre></div><p><strong>notify-github-actions.sh の例:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code">#!/bin/bash
set -euo pipefail

# GitHub の Deployment Status API を使用
curl -X POST \
  -H &quot;Authorization: token ${GITHUB_TOKEN}&quot; \
  -H &quot;Accept: application/vnd.github.v3+json&quot; \
  https://api.github.com/repos/owner/repo/deployments/${DEPLOYMENT_ID}/statuses \
  -d &#x27;{&quot;state&quot;:&quot;success&quot;,&quot;description&quot;:&quot;Deployed successfully via Dewy&quot;}&#x27;
</code></pre></div><h2 id="troubleshooting" class="heading">トラブルシューティング </h2><h3 id="common-issues" class="heading">よくある問題 </h3><p><strong>権限エラー:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># 問題：Permission denied
--before-deploy-hook &quot;systemctl stop nginx&quot;

# 解決策：ユーザー権限の確認と調整
sudo usermod -a -G sudo dewy
# または
sudo visudo  # NOPASSWDの設定
</code></pre></div><p><strong>パス問題:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># 問題：command not found
--after-deploy-hook &quot;npm install&quot;

# 解決策：フルパスまたはPATH設定
--after-deploy-hook &quot;/usr/local/bin/npm install&quot;
# または
--after-deploy-hook &quot;PATH=/usr/local/bin:$PATH npm install&quot;
</code></pre></div><p><strong>環境変数の問題:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># 問題：Environment variable not found
--before-deploy-hook &quot;echo $CUSTOM_VAR&quot;

# 解決策：環境変数の事前設定確認
systemctl edit dewy.service
# [Service]
# Environment=CUSTOM_VAR=value
</code></pre></div><h3 id="debugging" class="heading">デバッグ手法 </h3><p><strong>段階的な問題切り分け:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># 1. シンプルなコマンドから開始
--before-deploy-hook &quot;echo &#x27;Hook test&#x27;&quot;

# 2. 段階的に複雑化
--before-deploy-hook &quot;echo &#x27;Hook test&#x27; &amp;&amp; date&quot;

# 3. 実際のコマンド
--before-deploy-hook &quot;your-actual-command&quot;
</code></pre></div><p><strong>手動実行での検証:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># Dewyと同じ環境でテスト
cd /opt/myapp
sudo -u dewy /bin/sh -c &quot;your-hook-command&quot;
</code></pre></div><p><strong>ログ分析:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code"># フック関連ログの抽出
journalctl -u dewy.service | grep -i hook

# JSON形式ログの解析
journalctl -u dewy.service -o json | jq &#x27;select(.msg | contains(&quot;hook&quot;))&#x27;
</code></pre></div><h2 id="notification-integration" class="heading">通知連携 </h2><h3 id="hook-result-notification" class="heading">フック実行結果の自動通知 </h3><p>デプロイメントフックの実行結果は、設定された通知チャネル（Slack/Mail）に自動的に送信されます。</p><p><strong>通知される情報:</strong></p><ul><li>実行されたコマンド</li><li>実行結果（成功/失敗）</li><li>標準出力・エラー出力</li><li>実行時間</li><li>終了コード</li></ul><h3 id="notification-examples" class="heading">通知設定との組み合わせ例 </h3><p><strong>Slack通知付きの設定:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code">dewy server --registry ghr://owner/repo \
  --notifier &quot;slack://deploy-channel?title=MyApp&quot; \
  --before-deploy-hook &quot;scripts/backup-database.sh&quot; \
  --after-deploy-hook &quot;scripts/validate-deployment.sh&quot; \
  -- /opt/myapp/current/myapp
</code></pre></div><p><strong>Mail通知付きの設定:</strong></p><div aria-live="polite" class="jsx-434bf32da6e3c1fb code-block"><pre class="jsx-434bf32da6e3c1fb language-bash"><code class="jsx-434bf32da6e3c1fb code">dewy server --registry ghr://owner/repo \
  --notifier &quot;mail://smtp.company.com:587/ops@company.com&quot; \
  --before-deploy-hook &quot;scripts/pre-deploy-check.sh&quot; \
  --after-deploy-hook &quot;scripts/post-deploy-report.sh&quot; \
  -- /opt/myapp/current/myapp
</code></pre></div><div class="jsx-72fb50a247bdd974 callout note"><span class="jsx-72fb50a247bdd974 type-name note"><svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 24 24"><path d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm0,22A10,10,0,1,1,22,12,10.011,10.011,0,0,1,12,22Z"></path><path d="M12,10H11a1,1,0,0,0,0,2h1v6a1,1,0,0,0,2,0V12A2,2,0,0,0,12,10Z"></path><circle cx="12" cy="6.5" r="1.5"></circle></svg> <!-- -->note</span><strong class="jsx-72fb50a247bdd974"></strong><span class="jsx-72fb50a247bdd974"><p>通知チャネルの詳細な設定方法については、<a href="/ja/notifier">通知</a>ドキュメントを参照してください。</p></span></div><h2 id="related" class="heading">関連項目 </h2><ul><li><a href="/ja/architecture">アーキテクチャ</a> - デプロイプロセス全体でのフックの位置づけ</li><li><a href="/ja/notifier">通知</a> - 通知チャネルの詳細設定（Slack/Mail）</li><li><a href="/ja/versioning">バージョニング</a> - デプロイトリガーとしてのバージョン検出</li><li><a href="/ja/faq">FAQ</a> - デプロイメントフック関連のよくある質問</li></ul></article><div class="jsx-99a567945e15e890 edit-link"><a href="https://github.com/linyows/dewy/edit/main/docs/pages/ja/deployment-hooks.md" target="_blank" rel="noopener noreferrer" class="jsx-99a567945e15e890">Edit this page on GitHub</a></div></article></main><nav class="jsx-71cd323cadb53055 toc"><div class="jsx-71cd323cadb53055 toc-title"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="jsx-71cd323cadb53055"><path d="M17 6.1H3" class="jsx-71cd323cadb53055"></path><path d="M21 12.1H3" class="jsx-71cd323cadb53055"></path><path d="M15.1 18H3" class="jsx-71cd323cadb53055"></path></svg>このページの内容</div><ul class="jsx-a80eade5b09af88d"><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#overview-details">概要 </a></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#hook-types">フックの種類と動作 </a><ul class="jsx-a80eade5b09af88d"><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#before-hook">Before Deploy Hook </a></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#after-hook">After Deploy Hook </a></li></ul></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#execution-environment">実行環境と制約 </a><ul class="jsx-a80eade5b09af88d"><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#environment">実行環境 </a></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#execution-results">実行結果の取得 </a></li></ul></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#configuration">設定方法 </a><ul class="jsx-a80eade5b09af88d"><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#command-line">コマンドライン設定 </a></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#configuration-examples">設定例 </a></li></ul></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#use-cases">実用的なユースケース </a><ul class="jsx-a80eade5b09af88d"><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#database-operations">データベース操作 </a></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#service-management">サービス管理 </a></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#notification-monitoring">通知とモニタリング </a></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#configuration-management">設定とファイル管理 </a></li></ul></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#error-handling">エラーハンドリングと復旧 </a><ul class="jsx-a80eade5b09af88d"><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#before-hook-failure">Before Hook失敗時 </a></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#after-hook-failure">After Hook失敗時 </a></li></ul></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#security">セキュリティ考慮事項 </a><ul class="jsx-a80eade5b09af88d"><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#permission-management">権限管理 </a></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#injection-prevention">コマンドインジェクション対策 </a></li></ul></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#performance-monitoring">パフォーマンスと監視 </a><ul class="jsx-a80eade5b09af88d"><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#execution-time">実行時間の考慮 </a></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#monitoring-debug">監視とデバッグ </a></li></ul></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#best-practices">設定例とベストプラクティス </a><ul class="jsx-a80eade5b09af88d"><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#production-settings">本番環境での推奨設定 </a></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#development-staging">開発・ステージング環境 </a></li></ul></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#advanced-usage">高度な活用例 </a><ul class="jsx-a80eade5b09af88d"><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#blue-green">Blue-Green デプロイメント </a></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#cicd-integration">CI/CDパイプライン連携 </a></li></ul></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#troubleshooting">トラブルシューティング </a><ul class="jsx-a80eade5b09af88d"><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#common-issues">よくある問題 </a></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#debugging">デバッグ手法 </a></li></ul></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#notification-integration">通知連携 </a><ul class="jsx-a80eade5b09af88d"><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#hook-result-notification">フック実行結果の自動通知 </a></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#notification-examples">通知設定との組み合わせ例 </a></li></ul></li><li class="jsx-a80eade5b09af88d"><a href="/ja/deployment-hooks/#related">関連項目 </a></li></ul></nav></div></div><footer class="jsx-2c089a125ba37756"><p class="jsx-2c089a125ba37756">© 2018-<!-- -->2025<!-- --> linyows</p></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"markdoc":{"content":{"$$mdtype":"Tag","name":"article","attributes":{},"children":[{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"overview","level":1},"children":["デプロイメントフック"," "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["デプロイメントフックは、デプロイの前後にカスタムコマンドを実行する機能です。\nデータベースバックアップ、サービス管理、通知送信など、デプロイプロセスを柔軟にカスタマイズできます。\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"overview-details","level":2},"children":["概要 "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["デプロイメントフックは、Dewyの自動デプロイプロセスをカスタマイズするための強力な機能です。アプリケーションのデプロイ前後に任意のシェルコマンドを実行でき、データベースの操作、外部サービスとの連携、検証処理など、様々な用途に活用できます。"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["主な特徴:"]}]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["柔軟な実行タイミング"]},": デプロイ前後での実行制御"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["完全な環境アクセス"]},": 環境変数とファイルシステムへのフルアクセス"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["詳細な実行結果"]},": stdout/stderr、終了コード、実行時間の記録"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["通知連携"]},": 設定済み通知チャネルへの実行結果送信"]}]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"hook-types","level":2},"children":["フックの種類と動作 "]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"before-hook","level":3},"children":["Before Deploy Hook "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["デプロイが開始される",{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["前"]},"に実行されるフックです。"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["実行タイミング:"]}]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["アーティファクトダウンロード後"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["ファイル展開とシンボリックリンク作成前"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["アプリケーション再起動前"]}]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["重要な動作:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# Before Hookが失敗した場合、デプロイは中止される\ndewy server --registry ghr://owner/repo \\\n  --before-deploy-hook \"scripts/pre-check.sh\" \\\n  -- /opt/myapp/current/myapp\n"]},{"$$mdtype":"Tag","name":"Callout","attributes":{"type":"warning","title":"デプロイ中止の条件"},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Before Deploy Hookが0以外の終了コードで終了した場合、デプロイプロセス全体が中止されます。"," ","この動作により、事前条件が満たされていない場合の安全なデプロイ防止が可能です。"]}]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"after-hook","level":3},"children":["After Deploy Hook "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["デプロイが",{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["成功"]},"した後に実行されるフックです。"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["実行タイミング:"]}]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["ファイル展開とシンボリックリンク作成完了後"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["アプリケーション再起動完了後（server コマンドの場合）"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["デプロイプロセスの最終段階"]}]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["重要な動作:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# After Hookが失敗してもデプロイは成功として扱われる\ndewy server --registry ghr://owner/repo \\\n  --after-deploy-hook \"scripts/post-deploy-validation.sh\" \\\n  -- /opt/myapp/current/myapp\n"]},{"$$mdtype":"Tag","name":"Callout","attributes":{"type":"note"},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["After Deploy Hookの失敗はデプロイの成功ステータスに影響しません。"," ","ただし、エラーはログに記録され、設定されている場合は通知が送信されます。"]}]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"execution-environment","level":2},"children":["実行環境と制約 "]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"environment","level":3},"children":["実行環境 "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["フックは以下の環境で実行されます："]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["シェル実行:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["/bin/sh -c \"your-command\"\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["作業ディレクトリ:"]}]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["Dewyの実行ディレクトリ（通常はアプリケーションのルートディレクトリ）"]}]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["環境変数:"]}]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["Dewyプロセスのすべての環境変数を継承"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["実行時の環境変数へのフルアクセス"]}]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"execution-results","level":3},"children":["実行結果の取得 "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["フック実行時に以下の情報が記録されます："]},{"$$mdtype":"Tag","name":"Table","attributes":{},"children":[{"$$mdtype":"Tag","name":"thead","attributes":{},"children":[{"$$mdtype":"Tag","name":"tr","attributes":{},"children":[{"$$mdtype":"Tag","name":"th","attributes":{},"children":["項目"]},{"$$mdtype":"Tag","name":"th","attributes":{},"children":["説明"]},{"$$mdtype":"Tag","name":"th","attributes":{},"children":["用途"]}]}]},{"$$mdtype":"Tag","name":"tbody","attributes":{},"children":[{"$$mdtype":"Tag","name":"tr","attributes":{},"children":[{"$$mdtype":"Tag","name":"td","attributes":{},"children":["Command"]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["実行されたコマンド文字列"]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["デバッグとログ記録"]}]},{"$$mdtype":"Tag","name":"tr","attributes":{},"children":[{"$$mdtype":"Tag","name":"td","attributes":{},"children":["Stdout"]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["標準出力の内容"]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["実行結果の確認"]}]},{"$$mdtype":"Tag","name":"tr","attributes":{},"children":[{"$$mdtype":"Tag","name":"td","attributes":{},"children":["Stderr"]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["標準エラー出力"]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["エラー内容の把握"]}]},{"$$mdtype":"Tag","name":"tr","attributes":{},"children":[{"$$mdtype":"Tag","name":"td","attributes":{},"children":["ExitCode"]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["プロセス終了コード"]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["成功/失敗の判定"]}]},{"$$mdtype":"Tag","name":"tr","attributes":{},"children":[{"$$mdtype":"Tag","name":"td","attributes":{},"children":["Duration"]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["実行時間"]},{"$$mdtype":"Tag","name":"td","attributes":{},"children":["パフォーマンス監視"]}]}]}]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["ログ出力例:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"json"},"children":["{\n  \"time\": \"2024-03-15T10:30:45Z\",\n  \"level\": \"INFO\",\n  \"msg\": \"Execute hook success\",\n  \"command\": \"backup-database.sh\",\n  \"stdout\": \"Backup completed successfully\",\n  \"stderr\": \"\",\n  \"exit_code\": 0,\n  \"duration\": \"2.5s\"\n}\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"configuration","level":2},"children":["設定方法 "]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"command-line","level":3},"children":["コマンドライン設定 "]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# 基本形式\ndewy server --registry \u003cregistry-url\u003e \\\n  --before-deploy-hook \"\u003ccommand\u003e\" \\\n  --after-deploy-hook \"\u003ccommand\u003e\" \\\n  -- \u003capplication-command\u003e\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"configuration-examples","level":3},"children":["設定例 "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["単純なコマンド実行:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["dewy server --registry ghr://owner/repo \\\n  --before-deploy-hook \"echo 'Starting deployment'\" \\\n  --after-deploy-hook \"echo 'Deployment completed'\" \\\n  -- /opt/myapp/current/myapp\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["複数コマンドの連携:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["dewy server --registry ghr://owner/repo \\\n  --before-deploy-hook \"systemctl stop nginx \u0026\u0026 backup-db.sh\" \\\n  --after-deploy-hook \"systemctl start nginx \u0026\u0026 send-notification.sh\" \\\n  -- /opt/myapp/current/myapp\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["スクリプトファイルの実行:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["dewy server --registry ghr://owner/repo \\\n  --before-deploy-hook \"/opt/scripts/pre-deploy.sh\" \\\n  --after-deploy-hook \"/opt/scripts/post-deploy.sh\" \\\n  -- /opt/myapp/current/myapp\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"use-cases","level":2},"children":["実用的なユースケース "]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"database-operations","level":3},"children":["データベース操作 "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["バックアップの自動実行:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# PostgreSQL バックアップ\n--before-deploy-hook \"pg_dump myapp_db \u003e /backup/myapp_$(date +%Y%m%d_%H%M%S).sql\"\n\n# MySQL バックアップ\n--before-deploy-hook \"mysqldump -u root -p myapp_db \u003e /backup/myapp_$(date +%Y%m%d_%H%M%S).sql\"\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["マイグレーションの実行:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# Rails マイグレーション\n--after-deploy-hook \"cd /opt/myapp/current \u0026\u0026 bundle exec rake db:migrate\"\n\n# Django マイグレーション\n--after-deploy-hook \"cd /opt/myapp/current \u0026\u0026 python manage.py migrate\"\n\n# Go マイグレーション（migrate ツール使用）\n--after-deploy-hook \"migrate -path /opt/myapp/current/migrations -database 'postgres://...' up\"\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"service-management","level":3},"children":["サービス管理 "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["関連サービスの制御:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# Nginx の一時停止と再開\n--before-deploy-hook \"systemctl stop nginx\"\n--after-deploy-hook \"systemctl start nginx \u0026\u0026 systemctl reload nginx\"\n\n# ロードバランサーからの切り離し\n--before-deploy-hook \"curl -X DELETE http://lb:8080/servers/$(hostname)\"\n--after-deploy-hook \"curl -X POST http://lb:8080/servers/$(hostname)\"\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["ヘルスチェックの実行:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# アプリケーションの起動確認\n--after-deploy-hook \"timeout 30 bash -c 'until curl -f http://localhost:8080/health; do sleep 1; done'\"\n\n# データベース接続確認\n--before-deploy-hook \"pg_isready -h localhost -p 5432 -d myapp_db\"\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"notification-monitoring","level":3},"children":["通知とモニタリング "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["外部システムへの通知:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# Datadog へのデプロイイベント送信\n--after-deploy-hook \"curl -X POST https://api.datadoghq.com/api/v1/events \\\n  -H 'DD-API-KEY: ${DD_API_KEY}' \\\n  -d '{\\\"title\\\":\\\"Deployment\\\",\\\"text\\\":\\\"App deployed\\\"}'\"\n\n# PagerDuty への通知\n--after-deploy-hook \"scripts/notify-pagerduty.sh deployment-success\"\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["メトリクス収集:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# デプロイ時間の記録\n--before-deploy-hook \"echo $(date +%s) \u003e /tmp/deploy_start\"\n--after-deploy-hook \"echo 'Deploy time: '$(($(date +%s) - $(cat /tmp/deploy_start)))'s'\"\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"configuration-management","level":3},"children":["設定とファイル管理 "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["設定ファイルの更新:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# 環境固有の設定適用\n--after-deploy-hook \"cp /opt/config/production.yml /opt/myapp/current/config.yml\"\n\n# テンプレートから設定生成\n--after-deploy-hook \"envsubst \u003c /opt/templates/app.conf.template \u003e /opt/myapp/current/app.conf\"\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["キャッシュのクリア:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# Redis キャッシュクリア\n--after-deploy-hook \"redis-cli FLUSHALL\"\n\n# ファイルキャッシュクリア\n--after-deploy-hook \"rm -rf /opt/myapp/current/tmp/cache/*\"\n\n# CDN キャッシュ無効化\n--after-deploy-hook \"curl -X POST 'https://api.cloudflare.com/client/v4/zones/${ZONE_ID}/purge_cache' \\\n  -H 'Authorization: Bearer ${CF_TOKEN}' -d '{\\\"purge_everything\\\":true}'\"\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"error-handling","level":2},"children":["エラーハンドリングと復旧 "]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"before-hook-failure","level":3},"children":["Before Hook失敗時 "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["Before Hookが失敗した場合の動作："]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["デプロイの自動中止"]},": プロセス全体が停止"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["エラーログの記録"]},": 詳細な実行結果をログに出力"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["通知の送信"]},": 設定されている場合、エラー通知を送信"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["現在の状態維持"]},": 既存のアプリケーションは影響を受けない"]}]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["推奨される復旧手順:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# 1. エラー原因の確認\ntail -f /var/log/dewy.log\n\n# 2. 手動でのフック実行テスト\n/bin/sh -c \"your-before-hook-command\"\n\n# 3. 問題修正後のデプロイ再試行\n# Dewyは次回のポーリングで自動的に再試行\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"after-hook-failure","level":3},"children":["After Hook失敗時 "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["After Hookが失敗した場合の動作："]},{"$$mdtype":"Tag","name":"ol","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["デプロイは成功として処理"]},": アプリケーションは新バージョンで稼働"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["エラーログの記録"]},": 失敗内容を詳細にログ出力"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["通知の送信"]},": 設定されている場合、警告通知を送信"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["手動対応の推奨"]},": 管理者による確認と対応が必要"]}]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["推奨される対応手順:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# 1. 新バージョンの動作確認\ncurl -f http://localhost:8080/health\n\n# 2. After Hookの手動実行\n/bin/sh -c \"your-after-hook-command\"\n\n# 3. 必要に応じて手動での後処理実行\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"security","level":2},"children":["セキュリティ考慮事項 "]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"permission-management","level":3},"children":["権限管理 "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["実行ユーザーの権限設定:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# Dewyを専用ユーザーで実行\nsudo useradd -r -s /bin/bash dewy\nsudo chown -R dewy:dewy /opt/myapp\n\n# 必要最小限の権限でサービス定義\n# /etc/systemd/system/dewy.service\n[Service]\nUser=dewy\nGroup=dewy\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["sudo使用時の注意点:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# ❌ 危険：パスワードプロンプトでハング\n--before-deploy-hook \"sudo systemctl stop nginx\"\n\n# ✅ 安全：NOPASSWDまたは専用ユーザー権限設定\n--before-deploy-hook \"systemctl stop nginx\"  # systemd user session\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"injection-prevention","level":3},"children":["コマンドインジェクション対策 "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["安全なコマンド記述:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# ✅ 安全：クォートによる保護\n--before-deploy-hook \"backup-db.sh --name 'myapp_backup'\"\n\n# ❌ 危険：環境変数の直接展開\n--before-deploy-hook \"echo $USER_INPUT\"\n\n# ✅ 安全：環境変数の適切な使用\n--before-deploy-hook \"scripts/safe-command.sh\"  # スクリプト内で適切に処理\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["推奨される実装パターン:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["#!/bin/bash\n# scripts/safe-backup.sh\nset -euo pipefail\n\nDB_NAME=\"${DB_NAME:-myapp}\"\nBACKUP_DIR=\"${BACKUP_DIR:-/backup}\"\nTIMESTAMP=$(date +%Y%m%d_%H%M%S)\n\npg_dump \"${DB_NAME}\" \u003e \"${BACKUP_DIR}/backup_${TIMESTAMP}.sql\"\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"performance-monitoring","level":2},"children":["パフォーマンスと監視 "]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"execution-time","level":3},"children":["実行時間の考慮 "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["長時間実行コマンドの対策:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# タイムアウト設定\n--before-deploy-hook \"timeout 300 large-backup.sh\"\n\n# バックグラウンド実行（注意：デプロイ完了を待たない）\n--after-deploy-hook \"nohup long-running-task.sh \u0026\"\n\n# 非同期処理への委譲\n--after-deploy-hook \"queue-job.sh heavy-processing\"\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"monitoring-debug","level":3},"children":["監視とデバッグ "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["詳細ログの有効化:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# デバッグレベルでの実行\ndewy server --log-format json --log-level debug \\\n  --registry ghr://owner/repo \\\n  --before-deploy-hook \"verbose-script.sh\"\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["パフォーマンス測定:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# 実行時間測定付きのフック\n--before-deploy-hook \"time backup-database.sh\"\n--after-deploy-hook \"time validate-deployment.sh\"\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"best-practices","level":2},"children":["設定例とベストプラクティス "]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"production-settings","level":3},"children":["本番環境での推奨設定 "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["安全なバックアップ戦略:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["dewy server --registry ghr://company/myapp \\\n  --before-deploy-hook \"scripts/production-backup.sh\" \\\n  --after-deploy-hook \"scripts/production-validation.sh\" \\\n  --notifier \"slack://ops-alerts\" \\\n  -- /opt/myapp/current/myapp\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["production-backup.sh の例:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["#!/bin/bash\nset -euo pipefail\n\n# データベースバックアップ\npg_dump myapp_production \u003e \"/backup/pre-deploy-$(date +%Y%m%d_%H%M%S).sql\"\n\n# 設定ファイルバックアップ\ncp /opt/myapp/current/config.yml \"/backup/config-$(date +%Y%m%d_%H%M%S).yml\"\n\n# ヘルスチェック\ncurl -f http://localhost:8080/health || exit 1\n\necho \"Pre-deployment backup completed successfully\"\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"development-staging","level":3},"children":["開発・ステージング環境 "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["開発効率重視の設定:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["dewy server --registry \"ghr://company/myapp?pre-release=true\" \\\n  --interval 30s \\\n  --before-deploy-hook \"scripts/dev-prepare.sh\" \\\n  --after-deploy-hook \"scripts/dev-test.sh\" \\\n  --notifier \"slack://dev-deploys\" \\\n  -- /opt/myapp/current/myapp\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["自動テスト連携:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["#!/bin/bash\n# scripts/dev-test.sh\nset -euo pipefail\n\n# アプリケーション起動待機\nsleep 5\n\n# ヘルスチェック\ncurl -f http://localhost:8080/health\n\n# E2E テスト実行\ncd /opt/myapp/current \u0026\u0026 npm test\n\necho \"Development validation completed\"\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"advanced-usage","level":2},"children":["高度な活用例 "]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"blue-green","level":3},"children":["Blue-Green デプロイメント "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["トラフィック切り替えの自動化:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# Blue-Green切り替え用のフック設定\ndewy server --registry ghr://company/myapp \\\n  --before-deploy-hook \"scripts/prepare-green.sh\" \\\n  --after-deploy-hook \"scripts/switch-to-green.sh\" \\\n  -- /opt/myapp/current/myapp\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["switch-to-green.sh の例:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["#!/bin/bash\nset -euo pipefail\n\n# Green環境のヘルスチェック\nfor i in {1..30}; do\n  if curl -f http://localhost:8081/health; then\n    break\n  fi\n  sleep 2\ndone\n\n# ロードバランサーの切り替え\ncurl -X POST http://lb:8080/switch-to-green\n\n# Blue環境の停止（遅延実行）\nsleep 30 \u0026\u0026 systemctl stop myapp-blue \u0026\n\necho \"Traffic switched to green environment\"\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"cicd-integration","level":3},"children":["CI/CDパイプライン連携 "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["GitHub Actions との連携:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# デプロイ完了をGitHub Actionsに通知\n--after-deploy-hook \"scripts/notify-github-actions.sh\"\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["notify-github-actions.sh の例:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["#!/bin/bash\nset -euo pipefail\n\n# GitHub の Deployment Status API を使用\ncurl -X POST \\\n  -H \"Authorization: token ${GITHUB_TOKEN}\" \\\n  -H \"Accept: application/vnd.github.v3+json\" \\\n  https://api.github.com/repos/owner/repo/deployments/${DEPLOYMENT_ID}/statuses \\\n  -d '{\"state\":\"success\",\"description\":\"Deployed successfully via Dewy\"}'\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"troubleshooting","level":2},"children":["トラブルシューティング "]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"common-issues","level":3},"children":["よくある問題 "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["権限エラー:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# 問題：Permission denied\n--before-deploy-hook \"systemctl stop nginx\"\n\n# 解決策：ユーザー権限の確認と調整\nsudo usermod -a -G sudo dewy\n# または\nsudo visudo  # NOPASSWDの設定\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["パス問題:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# 問題：command not found\n--after-deploy-hook \"npm install\"\n\n# 解決策：フルパスまたはPATH設定\n--after-deploy-hook \"/usr/local/bin/npm install\"\n# または\n--after-deploy-hook \"PATH=/usr/local/bin:$PATH npm install\"\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["環境変数の問題:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# 問題：Environment variable not found\n--before-deploy-hook \"echo $CUSTOM_VAR\"\n\n# 解決策：環境変数の事前設定確認\nsystemctl edit dewy.service\n# [Service]\n# Environment=CUSTOM_VAR=value\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"debugging","level":3},"children":["デバッグ手法 "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["段階的な問題切り分け:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# 1. シンプルなコマンドから開始\n--before-deploy-hook \"echo 'Hook test'\"\n\n# 2. 段階的に複雑化\n--before-deploy-hook \"echo 'Hook test' \u0026\u0026 date\"\n\n# 3. 実際のコマンド\n--before-deploy-hook \"your-actual-command\"\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["手動実行での検証:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# Dewyと同じ環境でテスト\ncd /opt/myapp\nsudo -u dewy /bin/sh -c \"your-hook-command\"\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["ログ分析:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["# フック関連ログの抽出\njournalctl -u dewy.service | grep -i hook\n\n# JSON形式ログの解析\njournalctl -u dewy.service -o json | jq 'select(.msg | contains(\"hook\"))'\n"]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"notification-integration","level":2},"children":["通知連携 "]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"hook-result-notification","level":3},"children":["フック実行結果の自動通知 "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":["デプロイメントフックの実行結果は、設定された通知チャネル（Slack/Mail）に自動的に送信されます。"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["通知される情報:"]}]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":["実行されたコマンド"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["実行結果（成功/失敗）"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["標準出力・エラー出力"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["実行時間"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":["終了コード"]}]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"notification-examples","level":3},"children":["通知設定との組み合わせ例 "]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["Slack通知付きの設定:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["dewy server --registry ghr://owner/repo \\\n  --notifier \"slack://deploy-channel?title=MyApp\" \\\n  --before-deploy-hook \"scripts/backup-database.sh\" \\\n  --after-deploy-hook \"scripts/validate-deployment.sh\" \\\n  -- /opt/myapp/current/myapp\n"]},{"$$mdtype":"Tag","name":"p","attributes":{},"children":[{"$$mdtype":"Tag","name":"strong","attributes":{},"children":["Mail通知付きの設定:"]}]},{"$$mdtype":"Tag","name":"Fence","attributes":{"data-language":"bash"},"children":["dewy server --registry ghr://owner/repo \\\n  --notifier \"mail://smtp.company.com:587/ops@company.com\" \\\n  --before-deploy-hook \"scripts/pre-deploy-check.sh\" \\\n  --after-deploy-hook \"scripts/post-deploy-report.sh\" \\\n  -- /opt/myapp/current/myapp\n"]},{"$$mdtype":"Tag","name":"Callout","attributes":{"type":"note"},"children":[{"$$mdtype":"Tag","name":"p","attributes":{},"children":["通知チャネルの詳細な設定方法については、",{"$$mdtype":"Tag","name":"a","attributes":{"href":"/ja/notifier"},"children":["通知"]},"ドキュメントを参照してください。"]}]},{"$$mdtype":"Tag","name":"Heading","attributes":{"id":"related","level":2},"children":["関連項目 "]},{"$$mdtype":"Tag","name":"ul","attributes":{},"children":[{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"/ja/architecture"},"children":["アーキテクチャ"]}," - デプロイプロセス全体でのフックの位置づけ"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"/ja/notifier"},"children":["通知"]}," - 通知チャネルの詳細設定（Slack/Mail）"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"/ja/versioning"},"children":["バージョニング"]}," - デプロイトリガーとしてのバージョン検出"]},{"$$mdtype":"Tag","name":"li","attributes":{},"children":[{"$$mdtype":"Tag","name":"a","attributes":{"href":"/ja/faq"},"children":["FAQ"]}," - デプロイメントフック関連のよくある質問"]}]}]},"frontmatter":{"title":"デプロイメントフック","description":"デプロイメントフックは、デプロイの前後にカスタムコマンドを実行する機能です。\nデータベースバックアップ、サービス管理、通知送信など、デプロイプロセスを柔軟にカスタマイズできます。\n"},"file":{"path":"/ja/deployment-hooks.md"}}},"__N_SSG":true},"page":"/ja/deployment-hooks","query":{},"buildId":"nrvWMDTFmOrVmYO9xH7ns","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>